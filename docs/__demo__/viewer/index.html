<!doctype html><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>LiteComics</title><link rel=icon type=image/svg+xml href=/favicon.svg><link rel=apple-touch-icon href=apple-touch-icon.png><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,segoe ui,roboto,helvetica neue,Arial,sans-serif;color:#e0e0e0;line-height:1.6;min-height:100vh}body.viewer{background:#000}.loading{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:rgba(0,0,0,.9);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999}.loading.hidden{display:none}.spinner{width:50px;height:50px;border:4px solid #333;border-top:4px solid #4a9eff;border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.loading-text{color:#fff;margin-top:20px;font-size:1.2rem}.viewer-body{margin:0;padding:0;overflow:hidden;background-color:#000}.viewer-container{width:100vw;height:100vh;display:flex;justify-content:center;align-items:center;overflow:hidden}.image-display{width:100%;height:100%;display:flex;justify-content:center;align-items:center;position:relative}.single-page{display:flex;justify-content:center;align-items:center;width:100%;height:100%}.single-page img{max-width:100vw;max-height:100vh;width:auto;height:auto;object-fit:contain}.double-page{display:flex;flex-direction:row;justify-content:center;align-items:center;width:100%;height:100%;gap:4px}.page{display:flex;justify-content:center;align-items:center;max-width:50vw;max-height:100vh;flex:initial}.page img{max-width:100%;max-height:100vh;width:auto;height:auto;object-fit:contain;display:block}.page-info{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background-color:rgba(0,0,0,.7);color:#fff;padding:8px 16px;border-radius:20px;font-size:.9rem;z-index:100;pointer-events:none;backdrop-filter:blur(5px);opacity:1;transition:opacity .5s ease-in-out}.toolbar{position:fixed;top:0;left:0;right:0;background-color:rgba(0,0,0,.85);padding:10px 20px;display:flex;flex-direction:column;gap:8px;align-items:center;z-index:200;opacity:0;transition:opacity .3s ease-in-out;backdrop-filter:blur(15px);pointer-events:none;max-height:90vh;overflow-y:auto}.toolbar-buttons{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:center;width:100%;max-width:100%}.toolbar-group{display:flex;gap:4px;align-items:center;padding:3px;background:rgba(0,0,0,.2);border-radius:10px;white-space:nowrap}.filename-display{color:#fff;font-size:.85rem;text-align:center;line-height:1.3;word-break:break-all;max-width:90vw}@media(max-width:1200px){.toolbar{padding:8px 12px}.toolbar-buttons{gap:8px}.toolbar-group{gap:3px;padding:2px}}@media(max-width:768px){.toolbar{padding:6px 8px}.toolbar-buttons{gap:6px}.filename-display{font-size:.75rem}}.toolbar.visible{opacity:1;pointer-events:auto}.toolbar-btn{background:rgba(255,255,255,.12);color:#fff;border:1px solid rgba(255,255,255,.2);padding:8px 14px;border-radius:8px;font-size:.85rem;font-weight:500;cursor:pointer;transition:all .2s cubic-bezier(.4,0,.2,1);white-space:nowrap;backdrop-filter:blur(10px);box-shadow:0 2px 8px rgba(0,0,0,.2)}.toolbar-btn:hover{background:rgba(255,255,255,.2);border-color:rgba(255,255,255,.4);box-shadow:0 4px 16px rgba(0,0,0,.3);transform:translateY(-1px)}.toolbar-btn:active{background:rgba(255,255,255,.15);transform:translateY(0);box-shadow:0 1px 4px rgba(0,0,0,.2)}@media(max-width:1200px){.toolbar-btn{padding:7px 12px;font-size:.8rem}}@media(max-width:768px){.toolbar-btn{padding:6px 10px;font-size:.75rem}}.help{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:rgba(0,0,0,.9);display:flex;justify-content:center;align-items:center;z-index:1000}.help-content{background-color:#2a2a2a;padding:40px;border-radius:12px;max-width:600px;box-shadow:0 4px 20px rgba(0,0,0,.5);text-align:left}.help-content h3{color:#fff;margin-bottom:20px;font-size:1.5rem;text-align:center}.help-content ul{list-style:none;padding:0}.help-content li{padding:10px 0;border-bottom:1px solid #3a3a3a;font-size:1.1rem}.help-content li:last-child{border-bottom:none}.help-content strong{color:#4a9eff;font-weight:600;display:inline-block;min-width:120px}.help-hint{margin-top:20px;text-align:center;color:#999;font-size:.9rem;font-style:italic}.help-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.help-header h3{margin:0}.close-help-btn{background:0 0;border:none;color:#fff;font-size:2rem;cursor:pointer;padding:0;width:30px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:background .2s}.close-help-btn:hover{background:rgba(255,255,255,.1)}@media(max-width:768px) and (orientation:portrait){.double-page{flex-direction:column}.page{max-width:100vw;max-height:50vh}.page img{max-height:50vh}}:fullscreen .viewer-container,:-webkit-full-screen .viewer-container,:-moz-full-screen .viewer-container{width:100vw;height:100vh}.page-sidebar{position:fixed;left:-320px;top:0;width:320px;height:100vh;background:rgba(28,28,28,.75);transition:left .3s ease;z-index:1000;box-shadow:2px 0 10px rgba(0,0,0,.5);display:flex;flex-direction:column}.page-sidebar.visible{left:0}.page-sidebar-content{display:flex;flex-direction:column;height:100%}.page-sidebar-header{display:flex;justify-content:space-between;align-items:center;padding:20px;border-bottom:2px solid #3a3a3a;flex-shrink:0}.page-sidebar-title{color:#fff;font-size:1.2rem;font-weight:600}.close-sidebar-btn{background:0 0;border:none;color:#fff;font-size:2rem;cursor:pointer;padding:0;width:30px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:background .2s}.close-sidebar-btn:hover{background:rgba(255,255,255,.1)}.page-list{display:flex;flex-direction:column;gap:2px;padding:20px;overflow-y:auto;flex:1}.page-item{position:relative;cursor:pointer;padding:10px 12px;border-radius:6px;transition:background .2s,transform .2s;background:rgba(42,42,42,.1);display:flex;align-items:center;gap:8px;color:#e0e0e0;font-size:.95rem}.page-item:hover{background:rgba(58,58,58,.4);transform:translateX(5px)}.page-item.current{background:#4a9eff;color:#fff;font-weight:600}.page-number{color:#999;font-weight:600;min-width:35px}.page-item.current .page-number{color:#fff}.file-name{flex:1;font-size:.8rem;overflow-wrap:break-word;word-break:break-all}.page-overlay{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,.95);z-index:2000;display:flex;flex-direction:column;overflow-y:auto}.page-overlay-header{display:flex;justify-content:space-between;align-items:center;padding:20px 40px;background:rgba(28,28,28,.98);border-bottom:2px solid #3a3a3a;position:sticky;top:0;z-index:10}.page-overlay-header h2{color:#fff;font-size:1.5rem;font-weight:600;margin:0}.close-overlay-btn{background:0 0;border:none;color:#fff;font-size:2.5rem;cursor:pointer;padding:0;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:background .2s}.close-overlay-btn:hover{background:rgba(255,255,255,.1)}.page-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:20px;padding:40px}.page-grid-item{position:relative;cursor:pointer;border-radius:8px;overflow:hidden;transition:transform .2s,box-shadow .2s;background:#2a2a2a;aspect-ratio:3/4}.page-grid-item:hover{transform:scale(1.05);box-shadow:0 8px 24px rgba(74,158,255,.4)}.page-grid-item.current{box-shadow:0 0 0 4px #4a9eff}.page-grid-thumbnail{width:100%;height:100%;object-fit:cover;display:block}.page-grid-number{position:absolute;bottom:10px;right:10px;background:rgba(0,0,0,.8);color:#fff;padding:6px 12px;border-radius:6px;font-size:1rem;font-weight:600}.page-grid-item.current .page-grid-number{background:#4a9eff}</style><body class="viewer viewer-body"><div id=loading class=loading><div class=spinner></div><div class=loading-text>Loading...</div></div><div id=viewer-container class=viewer-container><div id=image-display class=image-display></div><div id=page-info class=page-info>Loading...</div><div id=toolbar class=toolbar><div id=filename-display class=filename-display></div><div class=toolbar-buttons><div class=toolbar-group><button id=btn-back class=toolbar-btn title="Back to file list (ESC)">✕ Close</button></div><div class=toolbar-group><button id=btn-next class=toolbar-btn title="Next page (←)">◀◀</button>
<button id=btn-offset-down class=toolbar-btn title="Adjust offset: Go forward 1 page (↓)">◀</button>
<button id=btn-offset-up class=toolbar-btn title="Adjust offset: Go back 1 page (↑)">▶</button>
<button id=btn-prev class=toolbar-btn title="Previous page (→)">▶▶</button></div><div class=toolbar-group><button id=btn-thumbnails class=toolbar-btn title="Page list (P)">Pages</button>
<button id=btn-list class=toolbar-btn title="File name list (F)">Files</button></div><div class=toolbar-group><button id=btn-single class=toolbar-btn title="Toggle single/double page (S)">Single/Double</button>
<button id=btn-direction class=toolbar-btn title="Toggle reading direction (D)">RTL/LTR</button>
<button id=btn-fullscreen class=toolbar-btn title="Fullscreen (Enter)">Fullscreen</button>
<button id=btn-help class=toolbar-btn title="Help (H)">Help</button></div></div></div></div><div id=page-sidebar class=page-sidebar><div class=page-sidebar-content><div class=page-sidebar-header><div class=page-sidebar-title>File List</div><button id=close-sidebar class=close-sidebar-btn>×</button></div><div id=page-list class=page-list></div></div></div><div id=page-overlay class=page-overlay style=display:none><div class=page-overlay-header><h2>Page List</h2><button id=close-overlay class=close-overlay-btn>×</button></div><div id=page-grid class=page-grid></div></div><div id=help class=help style=display:none><div class=help-content><div class=help-header><h3>Keyboard Shortcuts</h3><button id=close-help class=close-help-btn>×</button></div><ul><li><strong>← / → / Space</strong>: Navigate pages<li><strong>↑ / ↓</strong>: Adjust offset (Go forward/back 1 page)<li><strong>Enter</strong>: Toggle fullscreen mode<li><strong>S</strong>: Toggle single/double page mode<li><strong>D</strong>: Toggle reading direction (RTL/LTR)<li><strong>P</strong>: Show page list<li><strong>F</strong>: Show file name list<li><strong>ESC / BS</strong>: Back to file list<li><strong>H</strong>: Show/hide this help</ul><p class=help-hint>Press H or × button to close</div></div><script>function fixUrl(e){const t=window.location.pathname.split("/"),n=t.indexOf("__demo__");if(n===-1)return e;const s=t.slice(0,n+1).join("/");if(e.match(/^\/api\/book\/.*\/list$/))return`${s}/../__data__/list.json`;const o=e.match(/^\/api\/book\/[^/]+\/image\/(\d+)$/);return o?`${s}/../__data__/image/${o[1]}.webp`:e}let currentFile="",images=[],imageCount=0,currentPage=0,offset=0,imageCache={},forceSinglePageMode=!1,readingDirection="rtl",pageInfoTimer=null;const MAX_FILE_HISTORY=512,HISTORY_KEY="viewer_file_history";function getFileHistory(){try{const e=localStorage.getItem(HISTORY_KEY);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load file history:",e),[]}}function saveFileHistory(e){try{localStorage.setItem(HISTORY_KEY,JSON.stringify(e))}catch(e){console.error("Failed to save file history:",e)}}function cleanupOldFiles(e){const n=getFileHistory(),t=n.filter(t=>t!==e);if(t.unshift(e),t.length>MAX_FILE_HISTORY){const e=t.slice(MAX_FILE_HISTORY);e.forEach(e=>{localStorage.removeItem(`viewer_page_${e}`),localStorage.removeItem(`viewer_offset_${e}`),localStorage.removeItem(`viewer_direction_${e}`)}),saveFileHistory(t.slice(0,MAX_FILE_HISTORY))}else saveFileHistory(t)}let sidebarVisible=!1;function showPageSidebar(){const e=document.getElementById("page-sidebar");e&&(e.classList.add("visible"),sidebarVisible=!0)}function hidePageSidebar(){const e=document.getElementById("page-sidebar");e&&(e.classList.remove("visible"),sidebarVisible=!1)}function togglePageSidebar(){showPageSidebar(),generatePageList()}function generatePageList(){const e=document.getElementById("page-list");if(!e||imageCount===0)return;e.innerHTML="";for(let t=0;t<imageCount;t++){const n=document.createElement("div");n.className="page-item",t===currentPage&&n.classList.add("current");const s=document.createElement("span");s.className="page-number",s.textContent=`${t+1}. `;const o=document.createElement("span");o.className="file-name",o.textContent=images[t]||`Page ${t+1}`,n.appendChild(s),n.appendChild(o),n.addEventListener("click",()=>{currentPage=t,displayCurrentPages()}),e.appendChild(n)}}function showPageOverlay(){const e=document.getElementById("page-overlay");e&&(e.style.display="flex",generatePageGrid())}function hidePageOverlay(){const e=document.getElementById("page-overlay");e&&(e.style.display="none")}function generatePageGrid(){const e=document.getElementById("page-grid");if(!e||imageCount===0)return;e.innerHTML="";for(let t=0;t<imageCount;t++){const n=document.createElement("div");n.className="page-grid-item",t===currentPage&&n.classList.add("current");const s=document.createElement("img");s.className="page-grid-thumbnail",s.src=fixUrl(`/api/book/${encodeURIComponent(currentFile)}/image/${t}`),s.alt=`Page ${t+1}`;const o=document.createElement("div");o.className="page-grid-number",o.textContent=t+1,n.appendChild(s),n.appendChild(o),n.addEventListener("click",()=>{currentPage=t,displayCurrentPages(),hidePageOverlay()}),e.appendChild(n)}}function showLoading(){const e=document.getElementById("loading");e&&e.classList.remove("hidden")}function hideLoading(){const e=document.getElementById("loading");e&&e.classList.add("hidden")}function showPageInfo(e=!1,t=1e3){const n=document.getElementById("page-info");n&&(n.style.opacity="1",pageInfoTimer&&(clearTimeout(pageInfoTimer),pageInfoTimer=null),e&&(pageInfoTimer=setTimeout(()=>{n.style.opacity="0"},t)))}function hidePageInfo(){const e=document.getElementById("page-info");e&&(e.style.opacity="0",pageInfoTimer&&(clearTimeout(pageInfoTimer),pageInfoTimer=null))}function getFileFromURL(){const e=window.location.hash;if(e&&e.length>1){const n=decodeURIComponent(e.substring(1)),t=n.split("/").filter(e=>e);if(t.length<2)return null;const s=t[0],o=t.slice(1).join("/");return{rootName:s,relativePath:o}}return null}async function loadImageList(){try{const e=getFileFromURL();if(console.log("fileInfo:",e),!e||!e.rootName||!e.relativePath)throw new Error("File not specified");currentFile=`${e.rootName}/${e.relativePath}`;const s=document.getElementById("filename-display");if(s){const t=e.relativePath.split("/").pop();s.textContent=t}const a=await fetch(fixUrl(`/api/book/${encodeURIComponent(e.rootName)}/${e.relativePath}/list`)),t=await a.json();if(console.log("画像リスト:",t),t.error)throw new Error(t.error);if(images=t.images,imageCount=t.count||images.length,console.log("画像数:",imageCount),imageCount===0)throw new Error("No images found");const o=localStorage.getItem(`viewer_page_${currentFile}`),i=localStorage.getItem(`viewer_offset_${currentFile}`),n=localStorage.getItem(`viewer_direction_${currentFile}`);if(o!==null){const e=parseInt(o);!isNaN(e)&&e>=-1&&e<=imageCount&&(currentPage=e,console.log("ページ位置を復元:",currentPage))}if(i!==null){const e=parseInt(i);isNaN(e)||(offset=Math.max(-1,Math.min(1,e)),console.log("オフセットを復元:",offset))}n!==null&&(n==="rtl"||n==="ltr")&&(readingDirection=n,console.log("読み方向を復元:",readingDirection)),await displayCurrentPages(!0)}catch(e){console.error("loadImageList error:",e),document.getElementById("page-info").textContent=`Error: ${e.message}`,hideLoading()}}async function loadImage(e){if(e<0||e>=imageCount)return null;if(imageCache[e])return imageCache[e];const t=fixUrl(`/api/book/${encodeURIComponent(currentFile)}/image/${e}`);return new Promise((n,s)=>{const o=new Image;o.onload=()=>{imageCache[e]=o,n(o)},o.onerror=()=>{s(new Error(`Failed to load image ${e}`))},o.src=t})}function isWideImage(e){return!!e&&e.naturalWidth/e.naturalHeight>=1}function isPortraitViewport(){return window.innerHeight>window.innerWidth}function getDisplayPage(e=currentPage){return e+offset}function isForceOnePageMode(){return isPortraitViewport()||forceSinglePageMode}async function displayCurrentPages(e=!1){console.log("displayCurrentPages 開始: currentPage=",currentPage,"offset=",offset),showLoading();const s=document.getElementById("image-display"),n=document.getElementById("page-info"),t=getDisplayPage();console.log("displayPage:",t),localStorage.setItem(`viewer_page_${currentFile}`,currentPage),localStorage.setItem(`viewer_offset_${currentFile}`,offset),localStorage.setItem(`viewer_direction_${currentFile}`,readingDirection),cleanupOldFiles(currentFile);const o=isForceOnePageMode();try{console.log("Image loading started:",t);const i=await loadImage(t);if(console.log("Image loading completed:",t,i),i&&isWideImage(i)||o){const e=document.createElement("div");if(e.className="single-page",i){const t=i.cloneNode();e.appendChild(t)}if(s.innerHTML="",s.appendChild(e),i){let e="";isWideImage(i)?e=" (Wide)":forceSinglePageMode?e=" (Single page)":isPortraitViewport()&&(e=" (Portrait display)"),n.textContent=`${t+1} / ${imageCount}${e}`}else n.textContent="Blank"}else{const e=document.createElement("div");e.className="double-page";const o=document.createElement("div");if(o.className="page page-first",i){const e=i.cloneNode();o.appendChild(e)}const a=t+1,r=await loadImage(a);if(r&&!isWideImage(r)){const c=document.createElement("div");c.className="page page-second";const l=r.cloneNode();c.appendChild(l),readingDirection==="ltr"?(e.appendChild(o),e.appendChild(c)):(e.appendChild(c),e.appendChild(o));const s=[];i&&t>=0&&t<imageCount&&s.push(t+1),r&&a>=0&&a<imageCount&&s.push(a+1),readingDirection==="rtl"&&s.reverse(),n.textContent=s.length>0?`${s.join("-")} / ${imageCount}`:"Blank"}else e.appendChild(o),i&&t>=0&&t<imageCount?n.textContent=`${t+1} / ${imageCount}`:n.textContent=`Blank`;s.innerHTML="",s.appendChild(e)}preloadAdjacentPages(t),hideLoading(),e&&showPageInfo(!0,1e3)}catch(e){n.textContent=`Error: ${e.message}`,showPageInfo(!0,1e3),hideLoading()}}async function preloadAdjacentPages(e){const t=[2,3,-1,-2,4,5,6,7];for(const s of t){const n=e+s;n>=0&&n<imageCount&&!imageCache[n]&&loadImage(n).catch(()=>{})}}function canMoveTo(e,t){const n=e+t,s=n>=0&&n<imageCount,o=n+1>=0&&n+1<imageCount,i=isForceOnePageMode();return i?s:s||o}async function movePages(e){const t=getDisplayPage(),i=isForceOnePageMode(),s=imageCache[t]||await loadImage(t);let n;if(i||s&&isWideImage(s))n=1;else{const s=t+e,o=imageCache[s]||await loadImage(s);n=o&&!isWideImage(o)?2:1}const o=currentPage+n*e;canMoveTo(o,offset)&&(currentPage=o),await displayCurrentPages()}async function nextPages(){await movePages(1)}async function prevPages(){await movePages(-1)}async function toLeft(){readingDirection==="ltr"?await prevPages():await nextPages()}async function toRight(){readingDirection==="ltr"?await nextPages():await prevPages()}function adjustOffset(e){let t=offset+e,n=currentPage;(t>1||t<-1)&&(n=currentPage+t,t=0),canMoveTo(n,t)&&(currentPage=n,offset=t),displayCurrentPages()}function adjustOffsetForward(){adjustOffset(1)}function adjustOffsetBackward(){adjustOffset(-1)}function toggleFullscreen(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen().catch(e=>{console.error("Failed to start fullscreen mode:",e)})}function backToList(){sessionStorage.removeItem("fileListIndex"),sessionStorage.removeItem("fileListPath"),history.back()}function toggleHelp(){const e=document.getElementById("help");e.style.display=e.style.display==="none"?"flex":"none"}function closeHelp(){const e=document.getElementById("help");e.style.display="none"}function updateButtonStates(){const e=document.getElementById("btn-direction"),t=document.getElementById("btn-single");e&&(e.textContent=readingDirection==="rtl"?"RTL ←":"LTR →"),t&&(t.textContent=forceSinglePageMode?"Single":"Double")}function toggleReadingDirection(){readingDirection=readingDirection==="rtl"?"ltr":"rtl",console.log("Reading direction changed to:",readingDirection),updateButtonStates(),displayCurrentPages()}document.addEventListener("keydown",e=>{switch(console.log("キー押下:",e.key),e.key){case"ArrowLeft":e.preventDefault(),toLeft();break;case"ArrowRight":e.preventDefault(),toRight();break;case" ":case"Spacebar":e.preventDefault(),nextPages();break;case"ArrowUp":e.preventDefault(),adjustOffsetBackward();break;case"ArrowDown":e.preventDefault(),adjustOffsetForward();break;case"Enter":e.preventDefault(),toggleFullscreen();break;case"s":case"S":e.preventDefault(),forceSinglePageMode=!forceSinglePageMode,displayCurrentPages();break;case"Escape":case"Backspace":e.preventDefault();const t=document.getElementById("page-sidebar"),n=document.getElementById("page-overlay");t&&t.classList.contains("visible")?hidePageSidebar():n&&n.style.display!=="none"?hidePageOverlay():document.fullscreenElement?document.exitFullscreen():backToList();break;case"h":case"H":e.preventDefault(),toggleHelp();break;case"p":case"P":e.preventDefault(),showPageOverlay();break;case"f":case"F":e.preventDefault(),togglePageSidebar();break;case"d":case"D":e.preventDefault(),toggleReadingDirection();break}}),document.addEventListener("DOMContentLoaded",()=>{showLoading(),loadImageList(),setupToolbar(),updateButtonStates(),document.getElementById("close-sidebar").addEventListener("click",hidePageSidebar),document.getElementById("close-overlay").addEventListener("click",hidePageOverlay),setupMouseNavigation(),setupTouchNavigation(),setupToolbarVisibility()});function setupToolbar(){document.getElementById("btn-back").addEventListener("click",backToList),document.getElementById("btn-thumbnails").addEventListener("click",showPageOverlay),document.getElementById("btn-list").addEventListener("click",togglePageSidebar),document.getElementById("btn-prev").addEventListener("click",prevPages),document.getElementById("btn-next").addEventListener("click",nextPages),document.getElementById("btn-offset-up").addEventListener("click",adjustOffsetBackward),document.getElementById("btn-offset-down").addEventListener("click",adjustOffsetForward),document.getElementById("btn-single").addEventListener("click",()=>{forceSinglePageMode=!forceSinglePageMode,updateButtonStates(),displayCurrentPages()}),document.getElementById("btn-direction").addEventListener("click",toggleReadingDirection),document.getElementById("btn-fullscreen").addEventListener("click",toggleFullscreen),document.getElementById("btn-help").addEventListener("click",toggleHelp),document.getElementById("close-help").addEventListener("click",closeHelp)}function setupMouseNavigation(){const e=document.getElementById("image-display");e.addEventListener("click",t=>{const n=e.getBoundingClientRect(),s=t.clientX-n.left,o=n.width;s<o/2?toLeft():toRight()})}function setupTouchNavigation(){const e=document.getElementById("image-display");let t=0,n=0,s=0,o=0;e.addEventListener("touchstart",e=>{t=e.changedTouches[0].screenX,n=e.changedTouches[0].screenY},{passive:!0}),e.addEventListener("touchend",e=>{s=e.changedTouches[0].screenX,o=e.changedTouches[0].screenY,i()},{passive:!0});function i(){const e=t-s,i=n-o,a=50;(e<0?-e:e)>(i<0?-i:i)&&(e<0?-e:e)>a&&(e>0?toLeft():toRight())}}let toolbarTimer;function setupToolbarVisibility(){const e=document.getElementById("toolbar"),t=document.getElementById("viewer-container"),n=document.getElementById("page-info");t.addEventListener("mousemove",t=>{const n=e.offsetHeight;t.clientY<n+50?(e.classList.add("visible"),clearTimeout(toolbarTimer)):e.matches(":hover")||(clearTimeout(toolbarTimer),e.classList.remove("visible")),t.clientY>window.innerHeight*.9?showPageInfo(!1):hidePageInfo()}),e.addEventListener("mouseenter",()=>{clearTimeout(toolbarTimer)}),e.addEventListener("mouseleave",()=>{e.classList.remove("visible")})}let resizeTimer;window.addEventListener("resize",()=>{clearTimeout(resizeTimer),resizeTimer=setTimeout(()=>{imageCount>0&&displayCurrentPages()},300)})</script>