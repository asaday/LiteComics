<!doctype html><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Settings - LiteComics</title><link rel=icon type=image/svg+xml href=/favicon.svg><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,sans-serif;background:#f5f5f5;padding:20px}.container{max-width:800px;margin:0 auto;background:#fff;border-radius:8px;padding:30px;box-shadow:0 2px 8px rgba(0,0,0,.1)}h1{margin-bottom:30px;color:#333}.section{margin-bottom:30px}.section h2{font-size:18px;margin-bottom:15px;color:#555}label{display:block;margin-bottom:8px;font-weight:500;color:#666}input[type=number],input[type=text]{width:100%;padding:10px;border:1px solid #ddd;border-radius:4px;font-size:14px;margin-bottom:15px}.roots-list{margin-bottom:15px}.root-item{display:flex;gap:10px;margin-bottom:10px;align-items:stretch}.root-item input[type=text]{padding:10px;border:1px solid #ddd;border-radius:4px;font-size:14px;margin-bottom:0;min-width:0}.root-item input[type=text]:nth-child(1){flex:3}.root-item input[type=text]:nth-child(2){flex:1}button{padding:10px 20px;border:none;border-radius:4px;cursor:pointer;font-size:14px;font-weight:500}.btn-primary{background:#0a84ff;color:#fff}.btn-primary:hover{background:#06c}.btn-secondary{background:#f0f0f0;color:#333}.btn-secondary:hover{background:#e0e0e0}.btn-danger{background:#ff3b30;color:#fff}.btn-danger:hover{background:#c00}.btn-small{padding:5px 10px;font-size:12px}.actions{display:flex;gap:10px;margin-top:30px}.message{padding:10px;margin-bottom:20px;border-radius:4px;display:none}.message.success{background:#d4edda;color:#155724;border:1px solid #c3e6cb}.message.error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}details{margin-bottom:15px}summary{cursor:pointer;font-weight:500;padding:10px;background:#f8f8f8;border-radius:4px;user-select:none}summary:hover{background:#f0f0f0}.handlers-content{margin-top:15px;padding:15px;border:1px solid #ddd;border-radius:4px;background:#fafafa}textarea{width:100%;min-height:200px;padding:10px;border:1px solid #ddd;border-radius:4px;font-family:monaco,menlo,monospace;font-size:12px;resize:vertical}.note{font-size:12px;color:#666;margin-top:5px}.checkbox-group{margin-bottom:15px}.checkbox-group label{display:flex;align-items:center;cursor:pointer;font-weight:400}.checkbox-group input[type=checkbox]{margin-right:10px;width:18px;height:18px;cursor:pointer}.checkbox-group .checkbox-note{margin-left:28px;font-size:12px;color:#999;margin-top:-10px;margin-bottom:15px}.config-path-info{background:#f8f8f8;border:1px solid #e0e0e0;border-radius:4px;padding:12px;margin-top:20px;font-family:monaco,menlo,monospace;font-size:12px;color:#555;word-break:break-all}.config-path-info strong{display:block;margin-bottom:6px;font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,sans-serif;color:#333}</style><div class=container><h1>LiteComics Settings</h1><div id=config-path class=config-path-info><strong>Config File Location:</strong>
<span id=config-path-value>Loading...</span></div><div id=message class=message></div><div class=section><h2>Server</h2><label for=port>Port Number</label>
<input type=number id=port min=1024 max=65535 value=8539><div class=checkbox-group><label><input type=checkbox id=disableGUI>
<span>Disable GUI Settings</span></label><div class=checkbox-note>When enabled, settings page and configuration APIs will be disabled. You'll
need to edit config.json manually.</div><label><input type=checkbox id=allowRename>
<span>Allow File/Folder Renaming</span></label><div class=checkbox-note>Allow users to rename files and folders via context menu.</div><label><input type=checkbox id=allowRemove>
<span>Allow File/Folder Removal</span></label><div class=checkbox-note>Allow users to delete files and folders via context menu.</div><label><input type=checkbox id=allowArchive>
<span>Allow Folder Archiving</span></label><div class=checkbox-note>Allow users to create ZIP archives of folders via context menu.</div></div></div><div class=section><h2>Root Directories</h2><div id=roots class=roots-list></div><button type=button class="btn-secondary btn-small" onclick=addRoot()>+ Add Directory</button></div><div class=section><h2>TLS/HTTPS (Optional)</h2><label for=tlsCertFile>Certificate File Path</label>
<input id=tlsCertFile placeholder=/path/to/cert.pem>
<label for=tlsKeyFile>Key File Path</label>
<input id=tlsKeyFile placeholder=/path/to/key.pem><div class=note>Leave empty to use HTTP. When both files are specified, server will use HTTPS.</div></div><div class=actions><button type=button class=btn-primary onclick=saveSettings()>Save Settings</button>
<button type=button class=btn-secondary onclick=saveAndRestart()>Save & Restart Server</button>
<button type=button class=btn-secondary onclick='location.href="/"'>Back</button></div></div><script>let config=null;async function loadSettings(){try{const t=await fetch("/api/settings/config"),e=await t.json();config=e.config||e,e.configPath&&(document.getElementById("config-path-value").textContent=e.configPath),document.getElementById("port").value=config.port||8539,document.getElementById("disableGUI").checked=config.disableGUI===!0,document.getElementById("allowRename").checked=config.allowRename===!0,document.getElementById("allowRemove").checked=config.allowRemove===!0,document.getElementById("allowArchive").checked=config.allowArchive===!0,config.tls&&(document.getElementById("tlsCertFile").value=config.tls.certFile||"",document.getElementById("tlsKeyFile").value=config.tls.keyFile||"");const n=document.getElementById("roots");n.innerHTML="",config.roots&&config.roots.length>0?config.roots.forEach((e)=>{addRootItem(typeof e=="string"?e:e.path,typeof e=="object"?e.name:"")}):addRoot()}catch(e){showMessage("Failed to load settings: "+e.message,"error")}}function addRootItem(e="",t=""){const a=document.getElementById("roots"),n=document.createElement("div");n.className="root-item";const o=document.createElement("input");o.type="text",o.placeholder="/path/to/comics",o.value=e;const i=document.createElement("input");i.type="text",i.placeholder="Name (optional)",i.value=t;const s=document.createElement("button");s.type="button",s.className="btn-danger btn-small",s.textContent="Remove",s.onclick=()=>n.remove(),n.appendChild(o),n.appendChild(i),n.appendChild(s),a.appendChild(n)}function addRoot(){addRootItem()}function getRootsFromUI(){const t=document.querySelectorAll(".root-item"),e=[];return t.forEach(t=>{const s=t.querySelectorAll('input[type="text"]'),n=s[0].value.trim(),o=s[1].value.trim();n&&(o?e.push({path:n,name:o}):e.push(n))}),e}async function saveSettings(){try{const t=parseInt(document.getElementById("port").value),n=getRootsFromUI();if(isNaN(t)||t<1024||t>65535){showMessage("Error: Port must be between 1024 and 65535","error");return}if(n.length===0){showMessage("Error: At least one root directory is required","error");return}const e={port:t,roots:n},a=document.getElementById("disableGUI").checked;a&&(e.disableGUI=!0);const r=document.getElementById("allowRename").checked;r&&(e.allowRename=!0);const c=document.getElementById("allowRemove").checked;c&&(e.allowRemove=!0);const l=document.getElementById("allowArchive").checked;l&&(e.allowArchive=!0);const s=document.getElementById("tlsCertFile").value.trim(),o=document.getElementById("tlsKeyFile").value.trim();s&&o&&(e.tls={certFile:s,keyFile:o});const i=await fetch("/api/settings/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!i.ok){const e=await i.text();throw new Error(e||"Failed to save settings")}showMessage("Settings saved successfully!","success")}catch(e){showMessage("Error: "+e.message,"error")}}async function saveAndRestart(){let e=!0;if(typeof showConfirmDialog=="function"?e=await showConfirmDialog("Restart the server now?"):typeof window!="undefined"&&typeof window.confirm=="function"&&(e=window.confirm("Restart the server now?")),!e)return;await saveSettings();try{await fetch("/api/settings/restart",{method:"POST"}),showMessage("Server is restarting...","success"),setTimeout(()=>{location.reload()},1e3)}catch{showMessage("Settings saved, but restart failed. Please restart manually.","error")}}function showMessage(e,t){const n=document.getElementById("message");n.textContent=e,n.className="message "+t,n.style.display="block"}loadSettings()</script>