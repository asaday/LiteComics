<!doctype html><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>LiteComics</title><link rel=icon type=image/svg+xml href=favicon.svg><link rel=apple-touch-icon href=apple-touch-icon.png><style>:root{--bg-primary:#1c1c1c;--bg-secondary:#242323;--bg-hover:#2d2d2d;--bg-active:#2a2a2a;--text-primary:#e0e0e0;--text-secondary:#8e8e93;--text-muted:#666;--border-primary:#464544;--border-secondary:#3a3a3a;--color-link:#0a84ff;--color-link-hover:#409cff;--color-accent:#0058d0;--color-error:#ff6b6b;--fg-on-accent:#ffffff;--overlay-light:rgba(255, 255, 255, 0.1);--overlay-shadow-popup:0 4px 12px rgba(0, 0, 0, 0.3);--overlay-shadow-menu:0 4px 12px rgba(0, 0, 0, 0.6);--bg-header:rgba(28, 28, 28, 0.98);--button-hover-bg:#5a5a5a;--button-hover-border:#888}body[data-theme=light]{--bg-primary:#ffffff;--bg-secondary:#f8f8f8;--bg-hover:#e5e5ea;--bg-active:#f5f5f7;--text-primary:#1d1d1f;--text-secondary:#6e6e73;--text-muted:#86868b;--border-primary:#d1d1d6;--border-secondary:#c7c7cc;--color-link:#007aff;--color-link-hover:#409cff;--color-accent:#0058d0;--color-error:#ff6b6b;--fg-on-accent:#1d1d1f;--overlay-light:rgba(0, 0, 0, 0.05);--overlay-shadow-popup:0 4px 12px rgba(0, 0, 0, 0.1);--overlay-shadow-menu:0 4px 12px rgba(0, 0, 0, 0.2);--bg-header:rgba(235, 235, 237, 0.98);--button-hover-bg:#d8d8d8;--button-hover-border:var(--text-muted)}*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,segoe ui,roboto,helvetica neue,Arial,sans-serif;color:var(--text-primary);line-height:1.6;min-height:100vh;background:var(--bg-primary);overflow:hidden}.container{position:fixed;inset:0;display:flex;flex-direction:column}.breadcrumb{padding:4px 16px 20px;background-color:var(--bg-secondary);border-top:1px solid var(--border-primary);font-size:1rem;color:var(--text-secondary);display:flex;align-items:center;justify-content:space-between;gap:4px;flex-shrink:0}.breadcrumb-title{flex:1;text-align:center;font-size:1.1rem;font-weight:500;color:var(--text-muted)}.breadcrumb-item{display:inline-block;max-width:200px;color:var(--color-link);text-decoration:none;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;vertical-align:bottom;cursor:pointer;transition:color .15s}.breadcrumb-item:hover{color:var(--color-link-hover)}.breadcrumb-home{max-width:none;font-size:1.2rem;padding:2px 0;overflow:visible}.breadcrumb-current{color:var(--text-primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.breadcrumb-separator{color:var(--text-muted);white-space:nowrap;user-select:none}.menu-container{position:relative;margin-left:auto}.menu-button{padding:0 4px;background:0 0;border:none;color:var(--text-primary);font-size:1.7rem;cursor:pointer;transition:background-color .2s}.menu-button:hover{background-color:var(--overlay-light)}.menu-popup{display:none;position:absolute;bottom:100%;right:0;min-width:120px;padding:8px;margin-top:4px;background-color:var(--bg-primary);border:1px solid var(--border-secondary);border-radius:8px;box-shadow:var(--overlay-shadow-popup);z-index:1000}.menu-popup.visible{display:block}.menu-item{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;color:var(--text-primary);border-radius:4px;cursor:pointer;transition:background-color .2s}.menu-item:hover{background-color:var(--overlay-light)}.menu-item-label{display:flex;align-items:center;gap:8px}.menu-item-controls{display:flex;gap:4px}.menu-btn{min-width:28px;padding:2px 8px;background:0 0;border:1px solid var(--border-primary);border-radius:4px;color:var(--text-primary);font-size:.85rem;cursor:pointer;transition:background-color .2s,border-color .2s}.menu-btn:hover{background-color:var(--overlay-light);border-color:var(--button-hover-border)}.file-list{flex:1;min-height:0;margin:16px 8px 8px;padding:0;background-color:var(--bg-primary);overflow-y:auto;overflow-x:hidden}.list-section{margin:0}.file-list-view{margin:0;padding:0;list-style:none}.file-list-view li{display:flex;align-items:center;gap:10px;padding:5px 20px;border-radius:10px;cursor:pointer}.file-list-view li:nth-child(even){background-color:var(--bg-primary)}.file-list-view li:nth-child(odd){background-color:var(--bg-active)}.file-list-view li:hover:not(.selected){background-color:var(--bg-hover)}.file-list-view li.selected{background-color:var(--color-accent);color:var(--fg-on-accent)}.file-list-view li.selected a,.file-list-view li.selected span{color:var(--fg-on-accent)!important;font-weight:400}.file-list-view li::before{display:inline-block;width:20px;min-width:20px;content:"";font-size:1.2rem;text-align:center;line-height:1;flex-shrink:0}.file-list-view li.directory::before{content:"üìÇ"}.file-list-view li.file::before{content:"üìÉ"}.file-list-view li.video::before{content:"üé¨"}.file-list-view li.audio::before{content:"üéµ"}.file-list-view li.book::before{content:"üìö"}.file-list-view li.image::before{content:"üñºÔ∏è"}.file-list-view li.text::before{content:"üìÑ"}.file-item-content{display:flex;flex:1;align-items:center;gap:10px;overflow:hidden}.file-list li a{flex:1;color:var(--text-primary);font-size:1rem;font-weight:400;line-height:1.3;text-decoration:none;white-space:normal;word-break:break-word;overflow:hidden}.file-list .directory span{flex:1;color:var(--text-primary);font-weight:400;line-height:1.3;white-space:normal;word-break:break-word;overflow:hidden}.file-list .file span{flex:1;color:var(--text-secondary);line-height:1.3;white-space:normal;word-break:break-word;overflow:hidden}.tile-section{display:grid;grid-template-columns:repeat( auto-fill,minmax(min(140px,calc(50% - 24px)),1fr) );gap:16px;padding:16px 20px;background-color:var(--bg-primary)}.tile-item{display:flex;flex-direction:column;background-color:var(--bg-active);overflow:hidden;cursor:pointer;transition:transform .2s,background-color .2s}.tile-item:hover{background-color:var(--bg-hover);transform:translateY(-2px)}.tile-item.selected{background-color:var(--color-accent);transform:translateY(-2px)}.tile-item.selected .tile-title{color:var(--fg-on-accent)}.tile-item a{display:flex;flex-direction:column;height:100%;text-decoration:none}.tile-thumbnail{width:100%;height:240px;background-color:var(--bg-active);object-fit:contain}.tile-title{padding:8px 2px;color:var(--text-primary);font-size:1rem;line-height:1.1;text-align:center;word-break:break-word}.error{padding:40px 20px;color:var(--color-error);font-size:1.1rem;text-align:center;background-color:rgba(255,107,107,.1);border:1px solid var(--color-error);border-radius:8px}#preview-overlay{display:none;position:fixed;inset:0;align-items:center;justify-content:center;background:rgba(0,0,0,.9);z-index:10000}#preview-overlay.visible{display:flex}#preview-container{position:relative;max-width:90%;max-height:90%;background:var(--bg-primary);border-radius:8px;overflow:auto}#preview-close{position:fixed;top:20px;right:20px;width:40px;height:40px;background:var(--bg-secondary);border:none;border-radius:50%;color:var(--text-primary);font-size:24px;cursor:pointer;z-index:10001}#preview-close:hover{background:var(--bg-hover)}#preview-content{padding:20px}#preview-content img{display:block;max-width:100%;height:auto}#preview-content pre{font-family:monospace;line-height:1.5;white-space:pre-wrap;word-wrap:break-word}#history-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.9);overflow-y:auto;z-index:10000}#history-overlay.visible{display:flex;flex-direction:column}.history-header{position:sticky;top:0;display:flex;justify-content:space-between;align-items:center;padding:20px 40px;background:var(--bg-header);border-bottom:2px solid var(--border-secondary);z-index:10}.history-header h2{margin:0;color:var(--fg-on-accent);font-size:1.5rem;font-weight:600}.history-header-buttons{display:flex;gap:12px}.history-clear-btn{padding:8px 16px;background:var(--color-error);border:none;border-radius:6px;color:var(--fg-on-accent);font-size:.95rem;cursor:pointer;transition:background .2s}.history-clear-btn:hover{background:var(--color-error);opacity:.8}.history-close-btn{display:flex;align-items:center;justify-content:center;width:40px;height:40px;padding:0;background:0 0;border:none;border-radius:50%;color:var(--fg-on-accent);font-size:2.5rem;cursor:pointer;transition:background .2s}.history-close-btn:hover{background:var(--overlay-light)}.history-list{flex:1;padding:20px 40px}.history-item{display:flex;align-items:stretch;gap:12px;min-height:60px;padding:12px 16px;margin-bottom:8px;background:var(--bg-active);border-radius:8px;transition:background .2s,transform .2s}.history-item-content{display:flex;flex:1;min-width:0;align-items:center;gap:12px;padding:4px;margin:-4px;border-radius:6px;cursor:pointer;transition:background .2s}.history-item-content:hover{background:var(--overlay-light)}.history-item-folder-btn{align-self:center;flex-shrink:0;padding:8px 16px;background:var(--bg-active);border:1px solid var(--border-primary);border-radius:6px;color:var(--text-primary);font-size:.9rem;font-weight:500;white-space:nowrap;cursor:pointer;transition:all .2s}.history-item-folder-btn:hover{background:var(--button-hover-bg);border-color:var(--button-hover-border);transform:translateY(-1px)}.history-item-icon{flex-shrink:0;font-size:1.5rem}.history-item-info{flex:1;min-width:0}.history-item-name{margin-bottom:4px;color:var(--text-primary);font-size:1rem;font-weight:500;line-height:1.2;white-space:normal;word-break:break-all;overflow:hidden;text-overflow:ellipsis}.history-item-path{color:var(--text-secondary);font-size:.85rem;line-height:1.2;white-space:normal;word-break:break-all;overflow:hidden;text-overflow:ellipsis}.history-item-time{flex-shrink:0;color:var(--text-muted);font-size:.8rem}.history-empty{padding:40px 20px;color:var(--text-secondary);font-size:1.1rem;text-align:center}.context-menu{display:none;position:fixed;min-width:200px;padding:4px 0;background:var(--bg-primary);border:1px solid var(--border-primary);border-radius:8px;box-shadow:var(--overlay-shadow-menu);overflow:hidden;z-index:10001}.context-menu.visible{display:block}.context-menu-item{padding:10px 16px;color:var(--text-primary);font-size:.95rem;cursor:pointer;user-select:none;transition:background-color .15s}.context-menu-item:hover{background-color:var(--color-accent);color:var(--fg-on-accent)}.context-menu-separator{height:1px;margin:4px 0;background-color:var(--border-secondary)}.context-menu-info{padding:12px 16px;color:var(--text-secondary);font-size:.85rem;border-bottom:1px solid var(--border-secondary);user-select:none;pointer-events:none}.context-menu-info-name{margin-bottom:6px;color:var(--text-primary);font-weight:600;word-break:break-all}.context-menu-info-details{display:flex;flex-direction:column;gap:2px}.confirm-dialog{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);display:none;justify-content:center;align-items:center;z-index:10000}.confirm-dialog.visible{display:flex}.confirm-dialog-content{background-color:var(--bg-secondary);border-radius:8px;padding:24px;min-width:300px;max-width:500px;box-shadow:var(--overlay-shadow-popup)}.confirm-dialog-message{color:var(--text-primary);font-size:.95rem;line-height:1.5;margin-bottom:20px;white-space:pre-wrap;word-break:break-word}.confirm-dialog-buttons{display:flex;gap:12px;justify-content:flex-end}.confirm-dialog-cancel,.confirm-dialog-ok{padding:8px 20px;border:1px solid var(--border-primary);border-radius:4px;background-color:var(--bg-hover);color:var(--text-primary);font-size:.9rem;cursor:pointer;transition:all .2s}.confirm-dialog-cancel:hover,.confirm-dialog-ok:hover{background-color:var(--bg-active);border-color:var(--button-hover-border)}.confirm-dialog-ok{background-color:var(--color-accent);color:var(--fg-on-accent);border-color:var(--color-accent)}.confirm-dialog-ok:hover{background-color:var(--color-link-hover);border-color:var(--color-link-hover)}.confirm-dialog-ok.destructive{background-color:var(--color-error);border-color:var(--color-error)}.confirm-dialog-ok.destructive:hover{background-color:#ff5252;border-color:#ff5252}.confirm-dialog-ok:focus,.confirm-dialog-cancel:focus{outline:2px solid var(--color-link);outline-offset:2px}.prompt-dialog{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);display:none;justify-content:center;align-items:center;z-index:10000}.prompt-dialog.visible{display:flex}.prompt-dialog-content{background-color:var(--bg-secondary);border-radius:8px;padding:24px;min-width:360px;max-width:640px;box-shadow:var(--overlay-shadow-popup)}.prompt-dialog-message{color:var(--text-primary);font-size:.95rem;line-height:1.5;margin-bottom:12px}.prompt-dialog-input{width:100%;padding:8px 12px;border:1px solid var(--border-primary);border-radius:4px;background-color:var(--bg-primary);color:var(--text-primary);font-size:.9rem;margin-bottom:16px;box-sizing:border-box}.prompt-dialog-input:focus{outline:2px solid var(--color-accent);outline-offset:0;border-color:var(--color-accent)}.prompt-dialog-buttons{display:flex;gap:12px;justify-content:flex-end}.prompt-dialog-cancel,.prompt-dialog-ok{padding:8px 20px;border:1px solid var(--border-primary);border-radius:4px;background-color:var(--bg-hover);color:var(--text-primary);font-size:.9rem;cursor:pointer;transition:all .2s}.prompt-dialog-cancel:hover,.prompt-dialog-ok:hover{background-color:var(--bg-active);border-color:var(--button-hover-border)}.prompt-dialog-ok{background-color:var(--color-accent);color:var(--fg-on-accent);border-color:var(--color-accent)}.prompt-dialog-ok:hover{background-color:var(--color-link-hover);border-color:var(--color-link-hover)}.prompt-dialog-ok:focus,.prompt-dialog-cancel:focus{outline:2px solid var(--color-accent);outline-offset:2px}</style><body class=file-list><div class=container><div id=file-list class=file-list><p>Loading...</div><div id=breadcrumb class=breadcrumb><div class=menu-container><button id=menu-button class=menu-button title=Menu>‚ò∞</button><div id=menu-popup class=menu-popup><div class=menu-item id=menu-history><div class=menu-item-label><span>üïí</span>
<span>History</span></div></div><div class=menu-item id=menu-theme><div class=menu-item-label><span id=theme-icon>üåì</span>
<span>Theme</span></div></div><div class=menu-item><div class=menu-item-controls><button id=font-size-decrease class=menu-btn title="Decrease (Ctrl + -)">A-</button>
<button id=font-size-reset class=menu-btn title=Reset>A</button>
<button id=font-size-increase class=menu-btn title="Increase (Ctrl + +)">A+</button></div></div><div class=menu-item id=menu-settings><div class=menu-item-label><span>‚öôÔ∏è</span>
<span>Settings</span></div></div></div></div></div></div><div id=preview-overlay><button id=preview-close>√ó</button><div id=preview-container><div id=preview-content></div></div></div><div id=history-overlay><div class=history-header><h2>History</h2><div class=history-header-buttons><button id=history-clear class=history-clear-btn>Clear All</button>
<button id=history-close class=history-close-btn>√ó</button></div></div><div id=history-list class=history-list></div></div><div id=confirm-dialog class=confirm-dialog><div class=confirm-dialog-content><div class=confirm-dialog-message></div><div class=confirm-dialog-buttons><button class=confirm-dialog-cancel>Cancel</button>
<button class=confirm-dialog-ok>OK</button></div></div></div><div id=prompt-dialog class=prompt-dialog><div class=prompt-dialog-content><div class=prompt-dialog-message></div><input class=prompt-dialog-input><div class=prompt-dialog-buttons><button class=prompt-dialog-cancel>Cancel</button>
<button class=prompt-dialog-ok>OK</button></div></div></div><script>function fixUrl(e){const n=window.location.pathname.split("/"),s=n.indexOf("__demo__");if(s===-1)return e;const t=n.slice(0,s+1).join("/");if(e.startsWith("/api/roots")||e.startsWith("/api/dir"))return`${t}/../__data__/roots.json`;if(e.startsWith("/#"))return`${t}`;const o=e.match(/^\/api\/book\/([^/]+)\/thumbnail$/);return o?`${t}/../__data__/thumbnail/${decodeURIComponent(o[1])}.webp`:e.startsWith("/viewer/")?`${t}${e}`:e.startsWith("/media/")?`${t}${e}`:e.startsWith("/settings/")?`${t}`:e}let files=[],currentIndex=0,currentRootName=null,currentRelativePath="",allowRename=!1,allowRemove=!1,allowArchive=!1,disableGUI=!1;const MAX_HISTORY_ITEMS=256,HISTORY_KEY="file_history";function getHistory(){try{const e=localStorage.getItem(HISTORY_KEY);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load history:",e),[]}}function saveHistory(e){try{localStorage.setItem(HISTORY_KEY,JSON.stringify(e))}catch(e){console.error("Failed to save history:",e)}}function addToHistory(e){const n=getHistory(),t=n.filter(t=>t.path!==e.path),s={path:e.path,name:e.name,type:e.type,timestamp:Date.now()};t.unshift(s),t.length>MAX_HISTORY_ITEMS&&t.splice(MAX_HISTORY_ITEMS),saveHistory(t)}function showConfirmDialog(e,t={}){return new Promise(n=>{const s=document.getElementById("confirm-dialog"),d=s.querySelector(".confirm-dialog-message"),o=s.querySelector(".confirm-dialog-ok"),i=s.querySelector(".confirm-dialog-cancel");d.textContent=e,t.destructive?o.classList.add("destructive"):o.classList.remove("destructive"),s.classList.add("visible"),setTimeout(()=>i.focus(),0);const a=()=>{l(),n(!0)},r=()=>{l(),n(!1)},c=e=>{e.key==="Enter"?(e.preventDefault(),e.stopPropagation(),a()):e.key==="Escape"&&(e.preventDefault(),e.stopPropagation(),r())},l=()=>{s.classList.remove("visible"),o.removeEventListener("click",a),i.removeEventListener("click",r),document.removeEventListener("keydown",c)};o.addEventListener("click",a),i.addEventListener("click",r),document.addEventListener("keydown",c)})}function showPromptDialog(e,t=""){return new Promise(n=>{const s=document.getElementById("prompt-dialog"),u=s.querySelector(".prompt-dialog-message"),o=s.querySelector(".prompt-dialog-input"),r=s.querySelector(".prompt-dialog-ok"),c=s.querySelector(".prompt-dialog-cancel");u.textContent=e,o.value=t,s.classList.add("visible"),setTimeout(()=>{o.focus(),o.select()},0);const i=()=>{const e=o.value.trim();d(),n(e)},a=()=>{d(),n(null)},l=e=>{e.key==="Enter"?(e.preventDefault(),e.stopPropagation(),i()):e.key==="Escape"&&(e.preventDefault(),e.stopPropagation(),a())},d=()=>{s.classList.remove("visible"),r.removeEventListener("click",i),c.removeEventListener("click",a),o.removeEventListener("keydown",l)};r.addEventListener("click",i),c.addEventListener("click",a),o.addEventListener("keydown",l)})}async function clearHistory(){await showConfirmDialog("Are you sure you want to clear all history?")&&(localStorage.removeItem(HISTORY_KEY),showHistoryOverlay())}function showHistoryOverlay(){const n=document.getElementById("history-overlay"),e=document.getElementById("history-list");n.classList.add("visible");const t=getHistory();if(t.length===0){e.innerHTML='<div class="history-empty">No history yet</div>';return}e.innerHTML="",t.forEach(t=>{const s=document.createElement("div");s.className="history-item";const n=document.createElement("div");n.className="history-item-content";const a=document.createElement("div");a.className="history-item-icon",a.textContent=t.type==="book"?"üìö":t.type==="video"?"üé¨":"üéµ";const o=document.createElement("div");o.className="history-item-info";const r=document.createElement("div");r.className="history-item-name",r.textContent=t.name;const c=document.createElement("div");c.className="history-item-path";const d=t.path.substring(0,t.path.lastIndexOf("/"));c.textContent=d||"/",o.appendChild(r),o.appendChild(c);const l=document.createElement("div");l.className="history-item-time",l.textContent=formatTime(t.timestamp),n.appendChild(a),n.appendChild(o),n.appendChild(l),n.addEventListener("click",()=>{t.type==="book"?window.location.href=fixUrl(`/viewer/#${encodeURIComponent(t.path)}`):(t.type==="video"||t.type==="audio")&&(window.location.href=fixUrl(`/media/#${encodeURIComponent(t.path)}`))});const i=document.createElement("button");i.className="history-item-folder-btn",i.textContent=" üìÅ ",i.addEventListener("click",e=>{e.stopPropagation();const n=t.path.substring(0,t.path.lastIndexOf("/"));hideHistoryOverlay(),window.location.hash=`#${encodeURIComponent(n)}`}),s.appendChild(n),s.appendChild(i),e.appendChild(s)})}function hideHistoryOverlay(){const e=document.getElementById("history-overlay");e.classList.remove("visible")}function formatTime(e){const i=Date.now(),t=i-e,n=Math.floor(t/6e4),s=Math.floor(t/36e5),o=Math.floor(t/864e5);if(n<1)return"Just now";if(n<60)return`${n}m ago`;if(s<24)return`${s}h ago`;if(o<7)return`${o}d ago`;const a=new Date(e);return a.toLocaleDateString()}let contextMenuFile=null;function createContextMenu(e){const t=document.createElement("div");t.id="context-menu",t.className="context-menu";const s=document.createElement("div");s.className="context-menu-info";const i=document.createElement("div");i.className="context-menu-info-name",i.textContent=e.name,s.appendChild(i);const o=document.createElement("div");if(o.className="context-menu-info-details",e.type!=="directory"){const t=document.createElement("div");t.className="context-menu-info-size",e.size!==0[0]&&e.size!==null&&(t.textContent=formatFileSize(e.size)),o.appendChild(t)}if(e.modified){const t=document.createElement("div");t.className="context-menu-info-date";const n=new Date(e.modified);t.textContent=formatFileDate(n),o.appendChild(t)}s.appendChild(o),t.appendChild(s);const n=(e,n)=>{const s=document.createElement("div");s.className="context-menu-item",s.textContent=e,s.addEventListener("click",()=>{hideContextMenu(),n()}),t.appendChild(s)},a=()=>{const e=document.createElement("div");e.className="context-menu-separator",t.appendChild(e)};return e.type!=="directory"&&(n("Download",()=>{const n=`/api/file/${encodeURIComponent(e.path)}`,t=document.createElement("a");t.href=fixUrl(n),t.download=e.name,t.click()}),n("Copy URL",async()=>{try{const n=`/api/file/${encodeURIComponent(e.path)}`,t=window.location.origin+fixUrl(n);navigator.clipboard&&navigator.clipboard.writeText?(await navigator.clipboard.writeText(t),alert("URL copied to clipboard")):showPromptDialog("Copy this URL:",t)}catch(t){console.error("Failed to copy URL:",t),showPromptDialog("Copy this URL:",window.location.origin+fixUrl(`/api/file/${encodeURIComponent(e.path)}`))}})),allowRename&&n("Rename",async()=>{const t=await showPromptDialog("Enter new name:",e.name);if(!t||t===e.name)return;try{const s=await fetch("/api/command/rename",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:e.path,newName:t})}),n=await s.json();n.error?alert(`Error: ${n.error}`):n.success&&await loadFileList(getCurrentDirParam())}catch(e){console.error("Failed to rename:",e),alert(`Failed to rename: ${e.message}`)}}),allowArchive&&e.type==="directory"&&n("Create ZIP archive",async()=>{if(!await showConfirmDialog(`Create ZIP archive of this folder?

${e.name}

This may take some time for large folders.`))return;try{const n=await fetch("/api/command/archive",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:e.path})}),t=await n.json();t.error?alert(`Error: ${t.error}`):t.success&&(alert(`Archive created: ${t.archiveName}`),await loadFileList(getCurrentDirParam()))}catch(e){console.error("Failed to archive:",e),alert(`Failed to archive: ${e.message}`)}}),allowRemove&&n("Delete",async()=>{const t=e.type==="directory"?"folder":"file";if(!await showConfirmDialog(`Are you sure you want to delete this ${t}?

${e.name}`,{destructive:!0}))return;try{const n=await fetch("/api/command/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:e.path})}),t=await n.json();t.error?alert(`Error: ${t.error}`):await loadFileList(getCurrentDirParam())}catch(e){console.error("Failed to delete:",e),alert(`Failed to delete: ${e.message}`)}}),t}function showContextMenu(e,t,n){contextMenuFile=n;const i=document.getElementById("context-menu");i&&i.remove();const s=createContextMenu(n);document.body.appendChild(s),s.style.left=`${e}px`,s.style.top=`${t}px`,s.classList.add("visible");const o=s.getBoundingClientRect();o.right>window.innerWidth&&(s.style.left=`${window.innerWidth-o.width-5}px`),o.bottom>window.innerHeight&&(s.style.top=`${window.innerHeight-o.height-5}px`)}function hideContextMenu(){const e=document.getElementById("context-menu");e.classList.remove("visible"),contextMenuFile=null}function formatFileSize(e){if(e===0)return"0 B";const t=1024,s=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(e)/Math.log(t));return Math.round(e/t**n*100)/100+" "+s[n]}function formatFileDate(e){const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),o=String(e.getHours()).padStart(2,"0"),i=String(e.getMinutes()).padStart(2,"0"),a=String(e.getSeconds()).padStart(2,"0");return`${t}/${n}/${s} ${o}:${i}:${a}`}function isImageFile(e){const t=[".jpg",".jpeg",".png",".gif",".webp",".bmp",".avif"],n=e.toLowerCase().split(".").pop();return t.includes("."+n)}function isTextFile(e){const t=[".txt",".md",".json",".xml",".log",".csv",".nfo"],n=e.toLowerCase().split(".").pop();return t.includes("."+n)}function isPreviewableFile(e){return isImageFile(e)||isTextFile(e)}async function showPreview(e){const n=document.getElementById("preview-overlay"),t=document.getElementById("preview-content");t.innerHTML="<p>Loading...</p>",n.classList.add("visible");try{const n=fixUrl(`/api/file/${encodeURIComponent(e.path)}`);if(isImageFile(e.name)){const s=document.createElement("img");s.src=n,s.alt=e.name,t.innerHTML="",t.appendChild(s)}else if(isTextFile(e.name)){const s=await fetch(n),o=await s.text(),e=document.createElement("pre");e.textContent=o,t.innerHTML="",t.appendChild(e)}}catch(e){t.innerHTML=`<p>Error: ${e.message}</p>`}}function hidePreview(){const e=document.getElementById("preview-overlay");e.classList.remove("visible")}let zoomLevel=100;function initZoom(){const e=localStorage.getItem("zoomLevel");e&&(zoomLevel=parseInt(e)),applyZoom()}function applyZoom(){const e=document.querySelector(".container");e&&(e.style.zoom=zoomLevel+"%")}function changeZoom(e){zoomLevel=Math.max(50,Math.min(200,zoomLevel+e)),applyZoom(),localStorage.setItem("zoomLevel",zoomLevel)}function resetZoom(){zoomLevel=100,applyZoom(),localStorage.setItem("zoomLevel",zoomLevel)}function initTheme(){const e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;e?document.body.setAttribute("data-theme",e):t||document.body.setAttribute("data-theme","light"),updateThemeIcon()}function updateThemeIcon(){const t=document.body.getAttribute("data-theme"),e=document.getElementById("theme-icon");e&&(e.textContent=t==="light"?"üåô":"‚òÄÔ∏è")}function toggleTheme(){const t=document.body.getAttribute("data-theme"),e=t==="light"?"dark":"light";document.body.setAttribute("data-theme",e),localStorage.setItem("theme",e),updateThemeIcon()}function toggleMenu(){const e=document.getElementById("menu-popup");e.classList.toggle("visible")}function hideMenu(){const e=document.getElementById("menu-popup");e.classList.remove("visible")}function getCurrentDirParam(){const e=window.location.hash;return e?decodeURIComponent(e.substring(1)):null}async function loadFileList(e=null){const t=document.getElementById("file-list");t.innerHTML="<p>Loading...</p>";try{const l=`/api/dir${e?`/${encodeURIComponent(e)}`:""}`,d=await fetch(fixUrl(l)),s=await d.json();if(s.error)throw new Error(s.error);files=s.files,currentRootName=s.rootName||null,currentRelativePath=s.relativePath||"",allowRename=s.allowRename,allowRemove=s.allowRemove,allowArchive=s.allowArchive,disableGUI=s.disableGUI;const i=document.getElementById("menu-settings");if(i&&(i.style.display=disableGUI?"none":""),t.innerHTML="",files.length===0){t.innerHTML="<p>No files found.</p>";return}const n={directory:files.filter(e=>e.type==="directory"),book:files.filter(e=>e.type==="book"),video:files.filter(e=>e.type==="video"),audio:files.filter(e=>e.type==="audio"),file:files.filter(e=>e.type==="file")};files=[...n.directory,...n.book,...n.video,...n.audio,...n.file];let a=0;const o=e=>{if(e.length===0)return;const n=document.createElement("div");n.className="list-section";const s=document.createElement("ul");s.className="file-list-view",e.forEach(e=>{s.appendChild(createListItem(e,a++))}),n.appendChild(s),t.appendChild(n)},u=e=>{if(e.length===0)return;const n=document.createElement("div");n.className="tile-section",e.forEach(e=>{n.appendChild(createTileItem(e,a++))}),t.appendChild(n)};o(n.directory),u(n.book),o(n.video),o(n.audio),o(n.file),updateBreadcrumb();const r=sessionStorage.getItem("fileListIndex"),h=sessionStorage.getItem("fileListPath"),m=currentRootName?`${currentRootName}/${currentRelativePath}`:"",c=localStorage.getItem(`fileList_index_${m}`);r&&h===currentRelativePath?(currentIndex=parseInt(r),sessionStorage.removeItem("fileListIndex"),sessionStorage.removeItem("fileListPath")):c!==null?currentIndex=parseInt(c):currentIndex=0,updateSelection()}catch(e){document.getElementById("file-list").innerHTML=`<p class="error">Error: ${e.message}</p>`}}function createListItem(e,t){const n=document.createElement("li");let o=e.type;e.type==="file"&&(isImageFile(e.name)?o="image":isTextFile(e.name)&&(o="text")),n.className=o,n.dataset.index=t;const s=document.createElement("div");if(s.className="file-item-content",e.type==="directory"){const t=document.createElement("a");t.href=fixUrl(`/#${encodeURIComponent(e.path)}`),t.textContent=e.name,s.appendChild(t)}else if(e.type==="video"||e.type==="audio"){const n=document.createElement("a");n.href=fixUrl(`/media/#${encodeURIComponent(e.path)}`),n.textContent=e.name,n.addEventListener("click",n=>{sessionStorage.setItem("fileListIndex",t),sessionStorage.setItem("fileListPath",currentRelativePath),addToHistory(e)}),s.appendChild(n)}else if(isPreviewableFile(e.name)){const t=document.createElement("a");t.href="#",t.textContent=e.name,t.addEventListener("click",t=>{t.preventDefault(),showPreview(e)}),s.appendChild(t)}else{const t=document.createElement("span");t.textContent=e.name,s.appendChild(t)}return n.appendChild(s),n.addEventListener("click",e=>{currentIndex=t,updateSelection(!1),e.target.tagName!=="A"&&e.preventDefault()}),n.addEventListener("contextmenu",t=>{t.preventDefault(),showContextMenu(t.clientX,t.clientY,e)}),n}function createTileItem(e,t){const n=document.createElement("div");n.className="tile-item",n.dataset.index=t;const s=document.createElement("a");s.href=fixUrl(`/viewer/#${encodeURIComponent(e.path)}`);const o=document.createElement("img");o.className="tile-thumbnail",o.src=fixUrl(`/api/book/${encodeURIComponent(e.path)}/thumbnail`),o.alt=e.name,o.loading="lazy";const i=document.createElement("div");return i.className="tile-title",i.textContent=e.name,s.appendChild(o),s.appendChild(i),n.appendChild(s),s.addEventListener("click",t=>{addToHistory(e)}),n.addEventListener("click",e=>{currentIndex=t,updateSelection(!1)}),n.addEventListener("contextmenu",t=>{t.preventDefault(),showContextMenu(t.clientX,t.clientY,e)}),n}function updateBreadcrumb(){const t=document.getElementById("breadcrumb"),a=t.querySelector(".menu-container");t.innerHTML="";const e=document.createElement("div");e.style.cssText="display:flex;align-items:center;gap:4px;flex:1;min-width:0;overflow:hidden";const o=(t,n=null,s=!1)=>{const o=document.createElement(n?"a":"span");o.textContent=t,o.className=s?"breadcrumb-current":"breadcrumb-item",n&&(o.href=n),e.appendChild(o)},i=()=>{const t=document.createElement("span");t.className="breadcrumb-separator",t.textContent="‚Ä∫",e.appendChild(t)},n=document.createElement("a"),s=document.createElement("img");if(s.src="favicon.svg",s.alt="Home",s.style.cssText="width:21x;height:21px;display:block",n.appendChild(s),n.className="breadcrumb-item breadcrumb-home",n.href=fixUrl("/"),e.appendChild(n),currentRootName){if(i(),o(currentRootName,currentRelativePath?`/#${encodeURIComponent(currentRootName)}`:null,!currentRelativePath),currentRelativePath){const e=currentRelativePath.split("/").filter(e=>e);let t=currentRootName;e.forEach((n,s)=>{i(),t+="/"+n;const a=s===e.length-1;o(n,a?null:`/#${encodeURIComponent(t)}`,a)})}}else{const t=document.createElement("span");t.className="breadcrumb-title",t.textContent="LiteComics",e.appendChild(t)}t.appendChild(e),t.appendChild(a)}function updateSelection(e=!0){const t=document.querySelectorAll("[data-index]");t.forEach(t=>{const n=parseInt(t.dataset.index);n===currentIndex?(t.classList.add("selected"),e&&t.scrollIntoView({block:"center"})):t.classList.remove("selected")});const n=currentRootName?`${currentRootName}/${currentRelativePath}`:"";localStorage.setItem(`fileList_index_${n}`,currentIndex)}function openSelected(){if(currentIndex<0||currentIndex>=files.length)return;document.querySelector(`[data-index="${currentIndex}"]`)?.querySelector("a")?.click()}document.addEventListener("keydown",async e=>{const t=document.getElementById("confirm-dialog"),n=document.getElementById("prompt-dialog");if(t&&t.classList.contains("visible")||n&&n.classList.contains("visible"))return;const s=()=>{const e=document.getElementById("history-overlay");if(e.classList.contains("visible"))return hideHistoryOverlay(),!0;const t=document.getElementById("preview-overlay");return!!t.classList.contains("visible")&&(hidePreview(),!0)},o=()=>{const e=document.querySelector(".tile-section");if(!e||files[currentIndex]?.type!=="book")return 0;const t=e.querySelectorAll("[data-index]");if(t.length===0)return 0;const s=t[0],o=s.offsetWidth,i=e.offsetWidth,n=16;return Math.floor((i+n)/(o+n))};switch(e.key){case"ArrowDown":e.preventDefault();const t=o();if(t>0){const e=currentIndex+t;if(e<files.length){currentIndex=e,updateSelection();break}}currentIndex<files.length-1&&(currentIndex++,updateSelection());break;case"ArrowRight":e.preventDefault(),currentIndex<files.length-1&&(currentIndex++,updateSelection());break;case"ArrowUp":e.preventDefault();const n=o();if(n>0){const e=currentIndex-n;if(e>=0){currentIndex=e,updateSelection();break}}currentIndex>0&&(currentIndex--,updateSelection());break;case"ArrowLeft":e.preventDefault(),currentIndex>0&&(currentIndex--,updateSelection());break;case"PageDown":e.preventDefault(),currentIndex=Math.min(currentIndex+10,files.length-1),updateSelection();break;case"PageUp":e.preventDefault(),currentIndex=Math.max(currentIndex-10,0),updateSelection();break;case"Enter":e.preventDefault(),openSelected();break;case"Escape":if(e.preventDefault(),s())break;if(!currentRootName&&!currentRelativePath)break;const i=currentRootName?`${currentRootName}/${currentRelativePath}`:"";localStorage.removeItem(`fileList_index_${i}`),history.back();break;case"Backspace":if(e.preventDefault(),s())break;if(!currentRootName&&!currentRelativePath)break;if(currentRelativePath){const e=currentRelativePath.split("/").filter(e=>e);e.pop();const t=e.length>0?`${currentRootName}/${e.join("/")}`:currentRootName;window.location.hash=`#${encodeURIComponent(t)}`}else currentRootName&&(window.location.hash="");break}}),initTheme(),initZoom(),document.getElementById("menu-button").addEventListener("click",e=>{e.stopPropagation(),toggleMenu()}),document.getElementById("menu-history").addEventListener("click",()=>{hideMenu(),showHistoryOverlay()}),document.getElementById("menu-settings").addEventListener("click",()=>{hideMenu(),window.location.href=fixUrl("/settings/")}),document.getElementById("history-close").addEventListener("click",hideHistoryOverlay),document.getElementById("history-clear").addEventListener("click",clearHistory),document.getElementById("menu-theme").addEventListener("click",toggleTheme),document.getElementById("font-size-decrease").addEventListener("click",()=>changeZoom(-10)),document.getElementById("font-size-reset").addEventListener("click",resetZoom),document.getElementById("font-size-increase").addEventListener("click",()=>changeZoom(10)),document.getElementById("preview-close").addEventListener("click",hidePreview),document.getElementById("preview-overlay").addEventListener("click",e=>{e.target.id==="preview-overlay"&&hidePreview()}),document.getElementById("history-overlay").addEventListener("click",e=>{e.target.id==="history-overlay"&&hideHistoryOverlay()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&hideContextMenu()}),document.addEventListener("click",e=>{const t=document.getElementById("menu-popup"),n=document.getElementById("menu-button");!t.contains(e.target)&&e.target!==n&&hideMenu(),hideContextMenu()}),loadFileList(getCurrentDirParam()),window.addEventListener("hashchange",()=>{loadFileList(getCurrentDirParam())})</script>