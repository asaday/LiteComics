<!doctype html><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>LiteComics</title><link rel=icon type=image/svg+xml href=/favicon.svg><link rel=apple-touch-icon href=apple-touch-icon.png><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,segoe ui,roboto,helvetica neue,Arial,sans-serif;color:#e0e0e0;line-height:1.6;min-height:100vh}body.file-list{background:#1c1c1c;margin:0;padding:0;overflow:hidden}body.file-list[data-theme=light]{background:#fff;color:#1d1d1f}.container{position:fixed;top:0;left:0;right:0;bottom:0;margin:0;padding:0;display:flex;flex-direction:column}.breadcrumb{margin:0;padding:4px 16px 20px;background-color:#242323;border-top:1px solid #464544;font-size:1rem;color:#8e8e93;display:flex;align-items:center;justify-content:space-between;gap:4px;flex-shrink:0}body[data-theme=light] .breadcrumb{background-color:#f8f8f8;border-top:2px solid #d1d1d6;color:#6e6e73}.breadcrumb:empty{display:flex}.breadcrumb-title{flex:1;text-align:center;font-size:1.1rem;font-weight:500;color:gray}.menu-container{position:relative;margin-left:auto}.menu-button{background:0 0;border:none;font-size:1.7rem;cursor:pointer;padding:0 4px;transition:background-color .2s;color:#e0e0e0}body[data-theme=light] .menu-button{color:#1d1d1f}.menu-button:hover{background-color:rgba(255,255,255,.1)}body[data-theme=light] .menu-button:hover{background-color:rgba(0,0,0,5%)}.menu-popup{display:none;position:absolute;bottom:100%;right:0;margin-top:4px;background-color:#2d2d2d;border:1px solid #3a3a3a;border-radius:8px;padding:8px;min-width:120px;z-index:1000;box-shadow:0 4px 12px rgba(0,0,0,.3)}body[data-theme=light] .menu-popup{background-color:#fff;border-color:#c7c7cc;box-shadow:0 4px 12px rgba(0,0,0,.1)}.menu-popup.visible{display:block}.menu-item{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;cursor:pointer;border-radius:4px;color:#e0e0e0;transition:background-color .2s}body[data-theme=light] .menu-item{color:#1d1d1f}.menu-item:hover{background-color:rgba(255,255,255,.1)}body[data-theme=light] .menu-item:hover{background-color:rgba(0,0,0,5%)}.menu-item-label{display:flex;align-items:center;gap:8px}.menu-item-controls{display:flex;gap:4px}.menu-btn{background:0 0;border:1px solid #666;color:#e0e0e0;font-size:.85rem;cursor:pointer;padding:2px 8px;border-radius:4px;transition:background-color .2s,border-color .2s;min-width:28px}body[data-theme=light] .menu-btn{color:#1d1d1f;border-color:#c7c7cc}.menu-btn:hover{background-color:rgba(255,255,255,.1);border-color:#999}body[data-theme=light] .menu-btn:hover{background-color:rgba(0,0,0,5%);border-color:#86868b}.breadcrumb-item{color:#0a84ff;cursor:pointer;transition:color .15s;text-decoration:none;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:200px;display:inline-block;vertical-align:bottom}body[data-theme=light] .breadcrumb-item{color:#007aff}.breadcrumb-item:hover{color:#409cff}.breadcrumb-home{font-size:1.2rem;padding:2px 0;max-width:none;overflow:visible}.breadcrumb-current{color:#e0e0e0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}body[data-theme=light] .breadcrumb-current{color:#1d1d1f}.breadcrumb-separator{color:#666;user-select:none;white-space:nowrap}body[data-theme=light] .breadcrumb-separator{color:#86868b}.file-list{background-color:#1c1c1c;border-radius:0;padding:0;margin:16px 8px 8px;overflow-y:auto;overflow-x:hidden;flex:1;min-height:0}body[data-theme=light] .file-list{background-color:#fff}.list-section{margin:0}.tile-section{display:grid;grid-template-columns:repeat( auto-fill,minmax(min(140px,calc(50% - 24px)),1fr) );gap:16px;padding:16px 20px;background-color:#1c1c1c}body[data-theme=light] .tile-section{background-color:#fff}.file-list-view{list-style:none;margin:0;padding:0}.file-list-view li{padding:5px 20px;cursor:pointer;display:flex;align-items:center;gap:10px;border-radius:10px}.file-list-view li:nth-child(even){background-color:#1c1c1c}.file-list-view li:nth-child(odd){background-color:#242424}body[data-theme=light] .file-list-view li:nth-child(even){background-color:#fff}body[data-theme=light] .file-list-view li:nth-child(odd){background-color:#fafafa}.file-list-view li:hover:not(.selected){background-color:#2d2d2d}body[data-theme=light] .file-list-view li:hover:not(.selected){background-color:#e5e5ea}.file-list-view li.selected{background-color:#0058d0;color:#fff}body[data-theme=light] .file-list-view li.selected{background-color:#0058d0;color:#fff}.file-list-view li.selected a,.file-list-view li.selected span{color:#fff!important;font-weight:400}.file-list-view li::before{content:"";font-size:1.2rem;min-width:20px;width:20px;text-align:center;flex-shrink:0;display:inline-block;line-height:1}.file-list-view li.directory::before{content:"üìÇ"}.file-list-view li.file::before{content:"üìÉ"}.file-list-view li.video::before{content:"üé¨"}.file-list-view li.audio::before{content:"üéµ"}.file-list-view li.book::before{content:"üìö"}.file-list-view li.image::before{content:"üñºÔ∏è"}.file-list-view li.text::before{content:"üìÑ"}.file-item-content{display:flex;align-items:center;gap:10px;flex:1;overflow:hidden}.tile-item{display:flex;flex-direction:column;cursor:pointer;overflow:hidden;transition:transform .2s,background-color .2s;background-color:#242424}body[data-theme=light] .tile-item{background-color:#f5f5f7}.tile-item:hover{transform:translateY(-2px);background-color:#2d2d2d}body[data-theme=light] .tile-item:hover{background-color:#e5e5ea}.tile-item.selected{background-color:#0058d0;transform:translateY(-2px)}body[data-theme=light] .tile-item.selected{background-color:#0058d0}.tile-item.selected .tile-title{color:#fff}.tile-item a{text-decoration:none;display:flex;flex-direction:column;height:100%}.tile-thumbnail{width:100%;height:240px;object-fit:contain;background-color:#202020}body[data-theme=light] .tile-thumbnail{background-color:#e0e0e0}.tile-title{padding:8px 2px;font-size:1rem;color:#e0e0e0;line-height:1.1;text-align:center;word-break:break-word}body[data-theme=light] .tile-title{color:#1d1d1f}.file-list li a{color:#e0e0e0;text-decoration:none;display:block;font-size:1rem;flex:1;font-weight:400;white-space:normal;overflow:hidden;word-break:break-word;line-height:1.3}body[data-theme=light] .file-list li a{color:#1d1d1f}.file-list .directory span{color:#e0e0e0;font-weight:400;flex:1;white-space:normal;overflow:hidden;word-break:break-word;line-height:1.3}body[data-theme=light] .file-list .directory span{color:#1d1d1f}.file-list .file span{color:#8e8e93;flex:1;white-space:normal;overflow:hidden;word-break:break-word;line-height:1.3}body[data-theme=light] .file-list .file span{color:#6e6e73}.error{color:#ff6b6b;padding:40px 20px;text-align:center;font-size:1.1rem;background-color:rgba(255,107,107,.1);border-radius:8px;border:1px solid rgba(255,107,107,.3)}#preview-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.9);z-index:10000;align-items:center;justify-content:center}#preview-overlay.visible{display:flex}#preview-container{max-width:90%;max-height:90%;background:#fff;border-radius:8px;overflow:auto;position:relative}[data-theme=dark] #preview-container{background:#2d2d2d;color:#e0e0e0}#preview-close{position:fixed;top:20px;right:20px;background:rgba(255,255,255,.9);border:none;color:#333;font-size:24px;width:40px;height:40px;border-radius:50%;cursor:pointer;z-index:10001}[data-theme=dark] #preview-close{background:rgba(50,50,50,.9);color:#e0e0e0}#preview-close:hover{background:#fff}[data-theme=dark] #preview-close:hover{background:#464646}#preview-content{padding:20px}#preview-content img{max-width:100%;height:auto;display:block}#preview-content pre{white-space:pre-wrap;word-wrap:break-word;font-family:monospace;line-height:1.5}#history-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.9);z-index:10000;overflow-y:auto}#history-overlay.visible{display:flex;flex-direction:column}.history-header{display:flex;justify-content:space-between;align-items:center;padding:20px 40px;background:rgba(28,28,28,.98);border-bottom:2px solid #3a3a3a;position:sticky;top:0;z-index:10}body[data-theme=light] .history-header{background:rgba(235,235,237,.98);border-bottom-color:#d1d1d6}.history-header h2{color:#fff;font-size:1.5rem;font-weight:600;margin:0}body[data-theme=light] .history-header h2{color:#1d1d1f}.history-header-buttons{display:flex;gap:12px}.history-clear-btn{background:rgba(255,59,48,.9);border:none;color:#fff;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:.95rem;transition:background .2s}.history-clear-btn:hover{background:#ff3b30}.history-close-btn{background:0 0;border:none;color:#fff;font-size:2.5rem;cursor:pointer;padding:0;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:background .2s}body[data-theme=light] .history-close-btn{color:#1d1d1f}.history-close-btn:hover{background:rgba(255,255,255,.1)}body[data-theme=light] .history-close-btn:hover{background:rgba(0,0,0,5%)}.history-list{padding:20px 40px;flex:1}.history-item{display:flex;align-items:stretch;gap:12px;padding:12px 16px;margin-bottom:8px;background:#2a2a2a;border-radius:8px;transition:background .2s,transform .2s;min-height:60px}body[data-theme=light] .history-item{background:#f5f5f7}.history-item-content{display:flex;align-items:center;gap:12px;flex:1;min-width:0;cursor:pointer;padding:4px;margin:-4px;border-radius:6px;transition:background .2s}.history-item-content:hover{background:rgba(255,255,255,5%)}body[data-theme=light] .history-item-content:hover{background:rgba(0,0,0,3%)}.history-item-folder-btn{background:#4a4a4a;border:1px solid #666;color:#fff;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:.9rem;transition:all .2s;white-space:nowrap;flex-shrink:0;font-weight:500;align-self:center}body[data-theme=light] .history-item-folder-btn{background:#e8e8e8;border-color:#c7c7cc;color:#1d1d1f}.history-item-folder-btn:hover{background:#5a5a5a;border-color:#888;transform:translateY(-1px)}body[data-theme=light] .history-item-folder-btn:hover{background:#d8d8d8;border-color:#86868b}.history-item-icon{font-size:1.5rem;flex-shrink:0}.history-item-info{flex:1;min-width:0}.history-item-name{color:#e0e0e0;font-size:1rem;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:normal;word-break:break-all;line-height:1.2;margin-bottom:4px}body[data-theme=light] .history-item-name{color:#1d1d1f}.history-item-path{color:#8e8e93;font-size:.85rem;overflow:hidden;text-overflow:ellipsis;white-space:normal;word-break:break-all;line-height:1.2}body[data-theme=light] .history-item-path{color:#6e6e73}.history-item-time{color:#666;font-size:.8rem;flex-shrink:0}body[data-theme=light] .history-item-time{color:#86868b}.history-empty{text-align:center;color:#8e8e93;padding:40px 20px;font-size:1.1rem}body[data-theme=light] .history-empty{color:#6e6e73}</style><body class=file-list><div class=container><div id=file-list class=file-list><p>Loading...</div><div id=breadcrumb class=breadcrumb><div class=menu-container><button id=menu-button class=menu-button title=Menu>‚ò∞</button><div id=menu-popup class=menu-popup><div class=menu-item id=menu-history><div class=menu-item-label><span>üïí</span>
<span>History</span></div></div><div class=menu-item id=menu-theme><div class=menu-item-label><span id=theme-icon>üåì</span>
<span>Theme</span></div></div><div class=menu-item><div class=menu-item-controls><button id=font-size-decrease class=menu-btn title="Decrease (Ctrl + -)">A-</button>
<button id=font-size-reset class=menu-btn title=Reset>A</button>
<button id=font-size-increase class=menu-btn title="Increase (Ctrl + +)">A+</button></div></div><div class=menu-item id=menu-settings><div class=menu-item-label><span>‚öôÔ∏è</span>
<span>Settings</span></div></div></div></div></div></div><div id=preview-overlay><button id=preview-close>√ó</button><div id=preview-container><div id=preview-content></div></div></div><div id=history-overlay><div class=history-header><h2>History</h2><div class=history-header-buttons><button id=history-clear class=history-clear-btn>Clear All</button>
<button id=history-close class=history-close-btn>√ó</button></div></div><div id=history-list class=history-list></div></div><script>function fixUrl(e){const n=window.location.pathname.split("/"),s=n.indexOf("__demo__");if(s===-1)return e;const t=n.slice(0,s+1).join("/");if(e.startsWith("/api/roots"))return`${t}/../__data__/roots.json`;if(e.startsWith("/#"))return`${t}`;const o=e.match(/^\/api\/book\/([^/]+)\/thumbnail$/);return o?`${t}/../__data__/thumbnail/${decodeURIComponent(o[1])}.webp`:e.startsWith("/viewer/")?`${t}${e}`:e.startsWith("/media/")?`${t}${e}`:e.startsWith("/settings/")?`${t}`:e}let files=[],currentIndex=0,currentRootName=null,currentRelativePath="";const MAX_HISTORY_ITEMS=256,HISTORY_KEY="file_history";function getHistory(){try{const e=localStorage.getItem(HISTORY_KEY);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load history:",e),[]}}function saveHistory(e){try{localStorage.setItem(HISTORY_KEY,JSON.stringify(e))}catch(e){console.error("Failed to save history:",e)}}function addToHistory(e){const n=getHistory(),t=n.filter(t=>t.path!==e.path),s={path:e.path,name:e.name,type:e.type,timestamp:Date.now()};t.unshift(s),t.length>MAX_HISTORY_ITEMS&&t.splice(MAX_HISTORY_ITEMS),saveHistory(t)}function clearHistory(){confirm("Are you sure you want to clear all history?")&&(localStorage.removeItem(HISTORY_KEY),showHistoryOverlay())}function showHistoryOverlay(){const n=document.getElementById("history-overlay"),e=document.getElementById("history-list");n.classList.add("visible");const t=getHistory();if(t.length===0){e.innerHTML='<div class="history-empty">No history yet</div>';return}e.innerHTML="",t.forEach(t=>{const s=document.createElement("div");s.className="history-item";const n=document.createElement("div");n.className="history-item-content";const a=document.createElement("div");a.className="history-item-icon",a.textContent=t.type==="book"?"üìö":t.type==="video"?"üé¨":"üéµ";const o=document.createElement("div");o.className="history-item-info";const r=document.createElement("div");r.className="history-item-name",r.textContent=t.name;const c=document.createElement("div");c.className="history-item-path";const d=t.path.substring(0,t.path.lastIndexOf("/"));c.textContent=d||"/",o.appendChild(r),o.appendChild(c);const l=document.createElement("div");l.className="history-item-time",l.textContent=formatTime(t.timestamp),n.appendChild(a),n.appendChild(o),n.appendChild(l),n.addEventListener("click",()=>{t.type==="book"?window.location.href=fixUrl(`/viewer/#${encodeURIComponent(t.path)}`):(t.type==="video"||t.type==="audio")&&(window.location.href=fixUrl(`/media/#${encodeURIComponent(t.path)}`))});const i=document.createElement("button");i.className="history-item-folder-btn",i.textContent=" üìÅ ",i.addEventListener("click",e=>{e.stopPropagation();const n=t.path.substring(0,t.path.lastIndexOf("/"));hideHistoryOverlay(),window.location.hash=`#${encodeURIComponent(n)}`}),s.appendChild(n),s.appendChild(i),e.appendChild(s)})}function hideHistoryOverlay(){const e=document.getElementById("history-overlay");e.classList.remove("visible")}function formatTime(e){const i=Date.now(),t=i-e,n=Math.floor(t/6e4),s=Math.floor(t/36e5),o=Math.floor(t/864e5);if(n<1)return"Just now";if(n<60)return`${n}m ago`;if(s<24)return`${s}h ago`;if(o<7)return`${o}d ago`;const a=new Date(e);return a.toLocaleDateString()}function isImageFile(e){const t=[".jpg",".jpeg",".png",".gif",".webp",".bmp",".avif"],n=e.toLowerCase().split(".").pop();return t.includes("."+n)}function isTextFile(e){const t=[".txt",".md",".json",".xml",".log",".csv",".nfo"],n=e.toLowerCase().split(".").pop();return t.includes("."+n)}function isPreviewableFile(e){return isImageFile(e)||isTextFile(e)}async function showPreview(e){const n=document.getElementById("preview-overlay"),t=document.getElementById("preview-content");t.innerHTML="<p>Loading...</p>",n.classList.add("visible");try{const n=fixUrl(`/api/file/${encodeURIComponent(e.path)}`);if(isImageFile(e.name)){const s=document.createElement("img");s.src=n,s.alt=e.name,t.innerHTML="",t.appendChild(s)}else if(isTextFile(e.name)){const s=await fetch(n),o=await s.text(),e=document.createElement("pre");e.textContent=o,t.innerHTML="",t.appendChild(e)}}catch(e){t.innerHTML=`<p>Error: ${e.message}</p>`}}function hidePreview(){const e=document.getElementById("preview-overlay");e.classList.remove("visible")}let zoomLevel=100;function initZoom(){const e=localStorage.getItem("zoomLevel");e&&(zoomLevel=parseInt(e)),applyZoom()}function applyZoom(){const e=document.querySelector(".container");e&&(e.style.zoom=zoomLevel+"%")}function changeZoom(e){zoomLevel=Math.max(50,Math.min(200,zoomLevel+e)),applyZoom(),localStorage.setItem("zoomLevel",zoomLevel)}function resetZoom(){zoomLevel=100,applyZoom(),localStorage.setItem("zoomLevel",zoomLevel)}function initTheme(){const e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;e?document.body.setAttribute("data-theme",e):t||document.body.setAttribute("data-theme","light"),updateThemeIcon()}function updateThemeIcon(){const t=document.body.getAttribute("data-theme"),e=document.getElementById("theme-icon");e&&(e.textContent=t==="light"?"üåô":"‚òÄÔ∏è")}function toggleTheme(){const t=document.body.getAttribute("data-theme"),e=t==="light"?"dark":"light";document.body.setAttribute("data-theme",e),localStorage.setItem("theme",e),updateThemeIcon()}function toggleMenu(){const e=document.getElementById("menu-popup");e.classList.toggle("visible")}function hideMenu(){const e=document.getElementById("menu-popup");e.classList.remove("visible")}async function loadFileList(e=null){try{let s,n;if(e){if(s=await fetch(fixUrl(`/api/dir/${encodeURIComponent(e)}`)),n=await s.json(),n.error)throw new Error(n.error);files=n.files,currentRootName=n.rootName,currentRelativePath=n.relativePath||""}else{if(s=await fetch(fixUrl("/api/roots")),files=await s.json(),!Array.isArray(files))throw new Error(files.error||"Failed to load roots");currentRootName=null,currentRelativePath=""}const o=document.getElementById("file-list");if(o.innerHTML="",files.length===0){o.innerHTML="<p>No files found. Please check config.json.</p>";return}const t={directory:files.filter(e=>e.type==="directory"),book:files.filter(e=>e.type==="book"),video:files.filter(e=>e.type==="video"),audio:files.filter(e=>e.type==="audio"),file:files.filter(e=>e.type==="file")};files=[...t.directory,...t.book,...t.video,...t.audio,...t.file];let a=0;const i=e=>{if(e.length===0)return;const t=document.createElement("div");t.className="list-section";const n=document.createElement("ul");n.className="file-list-view",e.forEach(e=>{n.appendChild(createListItem(e,a++))}),t.appendChild(n),o.appendChild(t)},l=e=>{if(e.length===0)return;const t=document.createElement("div");t.className="tile-section",e.forEach(e=>{t.appendChild(createTileItem(e,a++))}),o.appendChild(t)};i(t.directory),l(t.book),i(t.video),i(t.audio),i(t.file),updateBreadcrumb();const r=sessionStorage.getItem("fileListIndex"),d=sessionStorage.getItem("fileListPath"),u=currentRootName?`${currentRootName}/${currentRelativePath}`:"",c=localStorage.getItem(`fileList_index_${u}`);r&&d===currentRelativePath?(currentIndex=parseInt(r),sessionStorage.removeItem("fileListIndex"),sessionStorage.removeItem("fileListPath")):c!==null?currentIndex=parseInt(c):currentIndex=0,updateSelection()}catch(e){document.getElementById("file-list").innerHTML=`<p class="error">Error: ${e.message}</p>`}}function createListItem(e,t){const s=document.createElement("li");let o=e.type;e.type==="file"&&(isImageFile(e.name)?o="image":isTextFile(e.name)&&(o="text")),s.className=o,s.dataset.index=t;const n=document.createElement("div");if(n.className="file-item-content",e.type==="directory"){const t=document.createElement("a");t.href=fixUrl(`/#${encodeURIComponent(e.path)}`),t.textContent=e.name,n.appendChild(t)}else if(e.type==="video"||e.type==="audio"){const s=document.createElement("a");s.href=fixUrl(`/media/#${encodeURIComponent(e.path)}`),s.textContent=e.name,s.addEventListener("click",n=>{sessionStorage.setItem("fileListIndex",t),sessionStorage.setItem("fileListPath",currentRelativePath),addToHistory(e)}),n.appendChild(s)}else if(isPreviewableFile(e.name)){const t=document.createElement("a");t.href="#",t.textContent=e.name,t.addEventListener("click",t=>{t.preventDefault(),showPreview(e)}),n.appendChild(t)}else{const t=document.createElement("span");t.textContent=e.name,n.appendChild(t)}return s.appendChild(n),s.addEventListener("click",e=>{currentIndex=t,updateSelection(!1),e.target.tagName!=="A"&&e.preventDefault()}),s}function createTileItem(e,t){const n=document.createElement("div");n.className="tile-item",n.dataset.index=t;const s=document.createElement("a");s.href=fixUrl(`/viewer/#${encodeURIComponent(e.path)}`);const o=document.createElement("img");o.className="tile-thumbnail",o.src=fixUrl(`/api/book/${encodeURIComponent(e.path)}/thumbnail`),o.alt=e.name,o.loading="lazy";const i=document.createElement("div");return i.className="tile-title",i.textContent=e.name,s.appendChild(o),s.appendChild(i),n.appendChild(s),s.addEventListener("click",t=>{addToHistory(e)}),n.addEventListener("click",e=>{currentIndex=t,updateSelection(!1)}),n}function updateBreadcrumb(){const t=document.getElementById("breadcrumb"),a=t.querySelector(".menu-container");t.innerHTML="";const e=document.createElement("div");e.style.cssText="display:flex;align-items:center;gap:4px;flex:1;min-width:0;overflow:hidden";const o=(t,n=null,s=!1)=>{const o=document.createElement(n?"a":"span");o.textContent=t,o.className=s?"breadcrumb-current":"breadcrumb-item",n&&(o.href=n),e.appendChild(o)},i=()=>{const t=document.createElement("span");t.className="breadcrumb-separator",t.textContent="‚Ä∫",e.appendChild(t)},n=document.createElement("a"),s=document.createElement("img");if(s.src="/favicon.svg",s.alt="Home",s.style.cssText="width:21x;height:21px;display:block",n.appendChild(s),n.className="breadcrumb-item breadcrumb-home",n.href=fixUrl("/"),e.appendChild(n),currentRootName){if(i(),o(currentRootName,currentRelativePath?`/#${encodeURIComponent(currentRootName)}`:null,!currentRelativePath),currentRelativePath){const e=currentRelativePath.split("/").filter(e=>e);let t=currentRootName;e.forEach((n,s)=>{i(),t+="/"+n;const a=s===e.length-1;o(n,a?null:`/#${encodeURIComponent(t)}`,a)})}}else{const t=document.createElement("span");t.className="breadcrumb-title",t.textContent="LiteComics",e.appendChild(t)}t.appendChild(e),t.appendChild(a)}function updateSelection(e=!0){const t=document.querySelectorAll("[data-index]");t.forEach(t=>{const n=parseInt(t.dataset.index);n===currentIndex?(t.classList.add("selected"),e&&t.scrollIntoView({block:"center"})):t.classList.remove("selected")});const n=currentRootName?`${currentRootName}/${currentRelativePath}`:"";localStorage.setItem(`fileList_index_${n}`,currentIndex)}function openSelected(){if(currentIndex<0||currentIndex>=files.length)return;document.querySelector(`[data-index="${currentIndex}"]`)?.querySelector("a")?.click()}document.addEventListener("keydown",async e=>{const t=()=>{const e=document.getElementById("history-overlay");if(e.classList.contains("visible"))return hideHistoryOverlay(),!0;const t=document.getElementById("preview-overlay");return!!t.classList.contains("visible")&&(hidePreview(),!0)},n=()=>{const e=document.querySelector(".tile-section");if(!e||files[currentIndex]?.type!=="book")return 0;const t=e.querySelectorAll("[data-index]");if(t.length===0)return 0;const s=t[0],o=s.offsetWidth,i=e.offsetWidth,n=16;return Math.floor((i+n)/(o+n))};switch(e.key){case"ArrowDown":e.preventDefault();const s=n();if(s>0){const e=currentIndex+s;if(e<files.length){currentIndex=e,updateSelection();break}}currentIndex<files.length-1&&(currentIndex++,updateSelection());break;case"ArrowRight":e.preventDefault(),currentIndex<files.length-1&&(currentIndex++,updateSelection());break;case"ArrowUp":e.preventDefault();const o=n();if(o>0){const e=currentIndex-o;if(e>=0){currentIndex=e,updateSelection();break}}currentIndex>0&&(currentIndex--,updateSelection());break;case"ArrowLeft":e.preventDefault(),currentIndex>0&&(currentIndex--,updateSelection());break;case"PageDown":e.preventDefault(),currentIndex=Math.min(currentIndex+10,files.length-1),updateSelection();break;case"PageUp":e.preventDefault(),currentIndex=Math.max(currentIndex-10,0),updateSelection();break;case"Enter":e.preventDefault(),openSelected();break;case"Escape":if(e.preventDefault(),t())break;if(!currentRootName&&!currentRelativePath)break;const i=currentRootName?`${currentRootName}/${currentRelativePath}`:"";localStorage.removeItem(`fileList_index_${i}`),history.back();break;case"Backspace":if(e.preventDefault(),t())break;if(!currentRootName&&!currentRelativePath)break;if(currentRelativePath){const e=currentRelativePath.split("/").filter(e=>e);e.pop();const t=e.length>0?`${currentRootName}/${e.join("/")}`:currentRootName;window.location.hash=`#${encodeURIComponent(t)}`}else currentRootName&&(window.location.hash="");break}}),initTheme(),initZoom(),document.getElementById("menu-button").addEventListener("click",e=>{e.stopPropagation(),toggleMenu()}),document.getElementById("menu-history").addEventListener("click",()=>{hideMenu(),showHistoryOverlay()}),document.getElementById("menu-settings").addEventListener("click",()=>{hideMenu(),window.location.href=fixUrl("/settings/")}),document.getElementById("history-close").addEventListener("click",hideHistoryOverlay),document.getElementById("history-clear").addEventListener("click",clearHistory),document.getElementById("menu-theme").addEventListener("click",toggleTheme),document.getElementById("font-size-decrease").addEventListener("click",()=>changeZoom(-10)),document.getElementById("font-size-reset").addEventListener("click",resetZoom),document.getElementById("font-size-increase").addEventListener("click",()=>changeZoom(10)),document.getElementById("preview-close").addEventListener("click",hidePreview),document.getElementById("preview-overlay").addEventListener("click",e=>{e.target.id==="preview-overlay"&&hidePreview()}),document.getElementById("history-overlay").addEventListener("click",e=>{e.target.id==="history-overlay"&&hideHistoryOverlay()}),document.addEventListener("click",e=>{const t=document.getElementById("menu-popup"),n=document.getElementById("menu-button");!t.contains(e.target)&&e.target!==n&&hideMenu()});const hash=window.location.hash,dirParam=hash?decodeURIComponent(hash.substring(1)):null;loadFileList(dirParam||null),window.addEventListener("hashchange",()=>{const e=window.location.hash,t=e?decodeURIComponent(e.substring(1)):null;loadFileList(t||null)})</script>