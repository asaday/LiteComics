<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LiteComics</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="stylesheet" href="style.css">
  <style>
    #preview-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }

    #preview-overlay.visible {
      display: flex;
    }

    #preview-container {
      max-width: 90%;
      max-height: 90%;
      background: white;
      border-radius: 8px;
      overflow: auto;
      position: relative;
    }

    [data-theme="dark"] #preview-container {
      background: #2d2d2d;
      color: #e0e0e0;
    }

    #preview-close {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.9);
      border: none;
      color: #333;
      font-size: 24px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      z-index: 10001;
    }

    [data-theme="dark"] #preview-close {
      background: rgba(50, 50, 50, 0.9);
      color: #e0e0e0;
    }

    #preview-close:hover {
      background: rgba(255, 255, 255, 1);
    }

    [data-theme="dark"] #preview-close:hover {
      background: rgba(70, 70, 70, 1);
    }

    #preview-content {
      padding: 20px;
    }

    #preview-content img {
      max-width: 100%;
      height: auto;
      display: block;
    }

    #preview-content pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: monospace;
      line-height: 1.5;
    }
  </style>
</head>
<body class="file-list">
  <div class="container">
    <div id="breadcrumb" class="breadcrumb">
      <button id="theme-toggle" class="theme-toggle" title="ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ">ğŸŒ“</button>
    </div>
    <div id="file-list" class="file-list">
      <p>èª­ã¿è¾¼ã¿ä¸­...</p>
    </div>
  </div>

  <div id="preview-overlay">
    <button id="preview-close">Ã—</button>
    <div id="preview-container">
      <div id="preview-content"></div>
    </div>
  </div>

  <script>
    let files = [];
    let currentIndex = 0;
    let currentRootName = null;
    let currentRelativePath = '';

    // ãƒ•ã‚¡ã‚¤ãƒ«ç¨®é¡ã®åˆ¤å®š
    function isImageFile(filename) {
      const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.bmp', '.avif'];
      const ext = filename.toLowerCase().split('.').pop();
      return imageExtensions.includes('.' + ext);
    }

    function isTextFile(filename) {
      const textExtensions = ['.txt', '.md', '.json', '.xml', '.log', '.csv', '.nfo'];
      const ext = filename.toLowerCase().split('.').pop();
      return textExtensions.includes('.' + ext);
    }

    function isPreviewableFile(filename) {
      return isImageFile(filename) || isTextFile(filename);
    }

    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
    async function showPreview(file) {
      const overlay = document.getElementById('preview-overlay');
      const content = document.getElementById('preview-content');
      
      content.innerHTML = '<p>èª­ã¿è¾¼ã¿ä¸­...</p>';
      overlay.classList.add('visible');

      try {
        const filePath = `/api/file/${encodeURIComponent(file.path)}`;
        
        if (isImageFile(file.name)) {
          const img = document.createElement('img');
          img.src = filePath;
          img.alt = file.name;
          content.innerHTML = '';
          content.appendChild(img);
        } else if (isTextFile(file.name)) {
          const response = await fetch(filePath);
          const text = await response.text();
          const pre = document.createElement('pre');
          pre.textContent = text;
          content.innerHTML = '';
          content.appendChild(pre);
        }
      } catch (err) {
        content.innerHTML = `<p>ã‚¨ãƒ©ãƒ¼: ${err.message}</p>`;
      }
    }

    function hidePreview() {
      const overlay = document.getElementById('preview-overlay');
      overlay.classList.remove('visible');
    }

    // ãƒ†ãƒ¼ãƒã®åˆæœŸåŒ–
    function initTheme() {
      const savedTheme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      
      if (savedTheme) {
        document.body.setAttribute('data-theme', savedTheme);
      } else if (!prefersDark) {
        document.body.setAttribute('data-theme', 'light');
      }
      
      updateThemeIcon();
    }

    // ãƒ†ãƒ¼ãƒã‚¢ã‚¤ã‚³ãƒ³ã®æ›´æ–°
    function updateThemeIcon() {
      const theme = document.body.getAttribute('data-theme');
      const toggle = document.getElementById('theme-toggle');
      if (toggle) {
        toggle.textContent = theme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
      }
    }

    // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ
    function toggleTheme() {
      const currentTheme = document.body.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      document.body.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateThemeIcon();
    }

    // ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’å–å¾—ã—ã¦è¡¨ç¤º
    async function loadFileList(dirPath = null) {
      try {
        let response, data;
        
        if (dirPath) {
          response = await fetch(`/api/dir/${encodeURIComponent(dirPath)}`);
          data = await response.json();
          files = data.files;
          currentRootName = data.rootName;
          currentRelativePath = data.relativePath || '';
        } else {
          response = await fetch('/api/roots');
          files = await response.json();
          currentRootName = null;
          currentRelativePath = '';
        }
        
        const fileListDiv = document.getElementById('file-list');
        fileListDiv.innerHTML = '';
        
        if (files.length === 0) {
          fileListDiv.innerHTML = '<p>ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚config.jsonã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>';
          return;
        }
        
        // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†ã‘ã¦ã€è¡¨ç¤ºé †ã«ä¸¦ã¹ã‚‹
        const directories = files.filter(f => f.isDirectory);
        const cbzFiles = files.filter(f => f.isArchive);
        const videoFiles = files.filter(f => f.isVideo);
        const audioFiles = files.filter(f => f.isAudio);
        const otherFiles = files.filter(f => !f.isDirectory && !f.isArchive && !f.isVideo && !f.isAudio);
        
        // è¡¨ç¤ºé †ã«ä¸¦ã¹ãŸé…åˆ—ã‚’ä½œæˆï¼ˆã“ã‚ŒãŒã‚«ãƒ¼ã‚½ãƒ«ç§»å‹•ã®é †åºã«ãªã‚‹ï¼‰
        files = [...directories, ...cbzFiles, ...videoFiles, ...audioFiles, ...otherFiles];
        
        // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒªã‚¹ãƒˆè¡¨ç¤º
        let displayIndex = 0;
        
        if (directories.length > 0) {
          const dirSection = document.createElement('div');
          dirSection.className = 'list-section';
          
          const ul = document.createElement('ul');
          ul.className = 'file-list-view';
          
          directories.forEach((file) => {
            const li = createListItem(file, displayIndex);
            ul.appendChild(li);
            displayIndex++;
          });
          
          dirSection.appendChild(ul);
          fileListDiv.appendChild(dirSection);
        }
        
        // CBZãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¿ã‚¤ãƒ«è¡¨ç¤º
        if (cbzFiles.length > 0) {
          const cbzSection = document.createElement('div');
          cbzSection.className = 'tile-section';
          
          cbzFiles.forEach((file) => {
            const tile = createTileItem(file, displayIndex);
            cbzSection.appendChild(tile);
            displayIndex++;
          });
          
          fileListDiv.appendChild(cbzSection);
        }
        
        // å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¹ãƒˆè¡¨ç¤º
        if (videoFiles.length > 0) {
          const videoSection = document.createElement('div');
          videoSection.className = 'list-section';
          
          const ul = document.createElement('ul');
          ul.className = 'file-list-view';
          
          videoFiles.forEach((file) => {
            const li = createListItem(file, displayIndex);
            ul.appendChild(li);
            displayIndex++;
          });
          
          videoSection.appendChild(ul);
          fileListDiv.appendChild(videoSection);
        }
        
        // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¹ãƒˆè¡¨ç¤º
        if (audioFiles.length > 0) {
          const audioSection = document.createElement('div');
          audioSection.className = 'list-section';
          
          const ul = document.createElement('ul');
          ul.className = 'file-list-view';
          
          audioFiles.forEach((file) => {
            const li = createListItem(file, displayIndex);
            ul.appendChild(li);
            displayIndex++;
          });
          
          audioSection.appendChild(ul);
          fileListDiv.appendChild(audioSection);
        }
        
        // ãã®ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¹ãƒˆè¡¨ç¤º
        if (otherFiles.length > 0) {
          const otherSection = document.createElement('div');
          otherSection.className = 'list-section';
          
          const ul = document.createElement('ul');
          ul.className = 'file-list-view';
          
          otherFiles.forEach((file) => {
            const li = createListItem(file, displayIndex);
            ul.appendChild(li);
            displayIndex++;
          });
          
          otherSection.appendChild(ul);
          fileListDiv.appendChild(otherSection);
        }
        
        // ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆã‚’æ›´æ–°
        updateBreadcrumb();
        
        // ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã‚’å¾©å…ƒ
        // 1. sessionStorageã‹ã‚‰ï¼ˆãƒ“ãƒ¥ãƒ¼ã‚¢ã‹ã‚‰æˆ»ã£ã¦ããŸå ´åˆï¼‰
        const savedIndexSession = sessionStorage.getItem('fileListIndex');
        const savedPathSession = sessionStorage.getItem('fileListPath');
        // 2. localStorageã‹ã‚‰ï¼ˆãƒªãƒ­ãƒ¼ãƒ‰ã—ãŸå ´åˆï¼‰
        const storageKey = currentRootName ? `${currentRootName}/${currentRelativePath}` : '';
        const savedIndexLocal = localStorage.getItem(`fileList_index_${storageKey}`);
        
        if (savedIndexSession && savedPathSession === currentRelativePath) {
          currentIndex = parseInt(savedIndexSession);
          sessionStorage.removeItem('fileListIndex');
          sessionStorage.removeItem('fileListPath');
        } else if (savedIndexLocal !== null) {
          currentIndex = parseInt(savedIndexLocal);
        } else {
          currentIndex = 0;
        }
        
        updateSelection();
      } catch (err) {
        document.getElementById('file-list').innerHTML = 
          `<p class="error">ã‚¨ãƒ©ãƒ¼: ${err.message}</p>`;
      }
    }

    // ãƒªã‚¹ãƒˆå½¢å¼ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’ä½œæˆ
    function createListItem(file, index) {
      const li = document.createElement('li');
      
      // ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆã¯ã‚¯ãƒ©ã‚¹ã‚’å¤‰æ›´ã—ã¦ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ã‚¤ã‚³ãƒ³ã‚’éè¡¨ç¤º
      if (file.isDirectory) {
        li.className = 'directory';
      } else if (file.isVideo || file.isAudio || file.isArchive || isImageFile(file.name) || isTextFile(file.name)) {
        li.className = 'media-file';
      } else {
        li.className = 'file';
      }
      
      li.dataset.index = index;
      
      const contentWrapper = document.createElement('div');
      contentWrapper.className = 'file-item-content';
      
      if (file.isDirectory) {
        const link = document.createElement('a');
        link.href = `/?dir=${encodeURIComponent(file.path)}`;
        link.textContent = file.name;
        contentWrapper.appendChild(link);
      } else if (file.isVideo) {
        const span = document.createElement('span');
        span.textContent = 'ğŸ¬ ' + file.name;
        contentWrapper.appendChild(span);
      } else if (file.isAudio) {
        const span = document.createElement('span');
        span.textContent = 'ğŸµ ' + file.name;
        contentWrapper.appendChild(span);
      } else if (isImageFile(file.name)) {
        const span = document.createElement('span');
        span.textContent = 'ğŸ–¼ï¸ ' + file.name;
        contentWrapper.appendChild(span);
      } else if (isTextFile(file.name)) {
        const span = document.createElement('span');
        span.textContent = 'ğŸ“„ ' + file.name;
        contentWrapper.appendChild(span);
      } else {
        const span = document.createElement('span');
        span.textContent = file.name;
        contentWrapper.appendChild(span);
      }
      
      li.appendChild(contentWrapper);
      
      li.addEventListener('click', (e) => {
        currentIndex = index;
        updateSelection(false);
        if (e.target.tagName !== 'A') {
          e.preventDefault();
        }
      });
      
      return li;
    }

    // ã‚¿ã‚¤ãƒ«å½¢å¼ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’ä½œæˆ
    function createTileItem(file, index) {
      const tile = document.createElement('div');
      tile.className = 'tile-item';
      tile.dataset.index = index;
      
      const link = document.createElement('a');
      link.href = `/viewer.html#/${encodeURIComponent(file.path)}`;
      
      const thumbnail = document.createElement('img');
      thumbnail.className = 'tile-thumbnail';
      thumbnail.src = `/api/archive/${encodeURIComponent(file.path)}/thumbnail`;
      thumbnail.alt = file.name;
      thumbnail.loading = 'lazy';
      
      const title = document.createElement('div');
      title.className = 'tile-title';
      title.textContent = file.name;
      
      link.appendChild(thumbnail);
      link.appendChild(title);
      tile.appendChild(link);
      
      tile.addEventListener('click', (e) => {
        currentIndex = index;
        updateSelection(false);
      });
      
      return tile;
    }

    // ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆã‚’æ›´æ–°
    function updateBreadcrumb() {
      const breadcrumbDiv = document.getElementById('breadcrumb');
      
      // ãƒ†ãƒ¼ãƒãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ã‚’ä¿æŒ
      const themeToggle = document.getElementById('theme-toggle');
      
      breadcrumbDiv.innerHTML = '';
      
      // ãƒ‘ãƒ³ããšéƒ¨åˆ†ã®ã‚³ãƒ³ãƒ†ãƒŠ
      const breadcrumbContent = document.createElement('div');
      breadcrumbContent.style.display = 'flex';
      breadcrumbContent.style.alignItems = 'center';
      breadcrumbContent.style.gap = '4px';
      breadcrumbContent.style.flex = '1';
      
      // ãƒ›ãƒ¼ãƒ ã‚¢ã‚¤ã‚³ãƒ³
      const home = document.createElement('a');
      home.href = '/';
      home.className = 'breadcrumb-item';
      home.textContent = 'Home';
      breadcrumbContent.appendChild(home);
      
      if (!currentRootName) {
        // ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®å ´åˆã¯ãƒ›ãƒ¼ãƒ ã®ã¿
        breadcrumbDiv.appendChild(breadcrumbContent);
        breadcrumbDiv.appendChild(themeToggle);
        return;
      }
      
      // ãƒ«ãƒ¼ãƒˆåã‚’è¿½åŠ 
      const separator1 = document.createElement('span');
      separator1.className = 'breadcrumb-separator';
      separator1.textContent = 'â€º';
      breadcrumbContent.appendChild(separator1);
      
      if (!currentRelativePath) {
        // ãƒ«ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ã®å ´åˆï¼ˆç¾åœ¨åœ°ï¼‰
        const rootCurrent = document.createElement('span');
        rootCurrent.className = 'breadcrumb-current';
        rootCurrent.textContent = currentRootName;
        breadcrumbContent.appendChild(rootCurrent);
      } else {
        // ãƒ«ãƒ¼ãƒˆåï¼ˆã‚¯ãƒªãƒƒã‚¯å¯èƒ½ï¼‰
        const rootLink = document.createElement('a');
        rootLink.href = `/?dir=${encodeURIComponent(currentRootName)}`;
        rootLink.className = 'breadcrumb-item';
        rootLink.textContent = currentRootName;
        breadcrumbContent.appendChild(rootLink);
      }
      
      if (currentRelativePath) {
        // ç›¸å¯¾ãƒ‘ã‚¹ã‚’åˆ†å‰²ã—ã¦å„éšå±¤ã‚’è¡¨ç¤º
        const pathParts = currentRelativePath.split('/').filter(p => p);
        let accumulatedPath = currentRootName;
        
        for (let i = 0; i < pathParts.length; i++) {
          const separator = document.createElement('span');
          separator.className = 'breadcrumb-separator';
          separator.textContent = 'â€º';
          breadcrumbContent.appendChild(separator);
          
          accumulatedPath = accumulatedPath + '/' + pathParts[i];
          
          if (i === pathParts.length - 1) {
            // æœ€å¾Œã®è¦ç´ ï¼ˆç¾åœ¨ã®ãƒ•ã‚©ãƒ«ãƒ€ï¼‰
            const item = document.createElement('span');
            item.textContent = pathParts[i];
            item.className = 'breadcrumb-current';
            breadcrumbContent.appendChild(item);
          } else {
            // ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ãªè¦ªãƒ•ã‚©ãƒ«ãƒ€
            const item = document.createElement('a');
            item.href = `/?dir=${encodeURIComponent(accumulatedPath)}`;
            item.className = 'breadcrumb-item';
            item.textContent = pathParts[i];
            breadcrumbContent.appendChild(item);
          }
        }
      }
      
      breadcrumbDiv.appendChild(breadcrumbContent);
      breadcrumbDiv.appendChild(themeToggle);
    }

    // é¸æŠçŠ¶æ…‹ã‚’æ›´æ–°
    function updateSelection(scroll = true) {
      const allItems = document.querySelectorAll('[data-index]');
      allItems.forEach((item) => {
        const index = parseInt(item.dataset.index);
        if (index === currentIndex) {
          item.classList.add('selected');
          if (scroll) {
            item.scrollIntoView({ block: 'center' });
          }
        } else {
          item.classList.remove('selected');
        }
      });
      
      // ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã‚’localStorageã«ä¿å­˜
      const storageKey = currentRootName ? `${currentRootName}/${currentRelativePath}` : '';
      localStorage.setItem(`fileList_index_${storageKey}`, currentIndex);
    }

    // é¸æŠä¸­ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’é–‹ã
    function openSelected() {
      if (currentIndex < 0 || currentIndex >= files.length) return;
      
      const file = files[currentIndex];
      
      if (file.isArchive) {
        // ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã¨ç¾åœ¨ã®ãƒ‘ã‚¹ã‚’ä¿å­˜
        sessionStorage.setItem('fileListIndex', currentIndex);
        sessionStorage.setItem('fileListPath', currentRelativePath);
        // ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ“ãƒ¥ãƒ¼ã‚¢ã§é–‹ã
        window.location.href = `/viewer.html#/${encodeURIComponent(file.path)}`;
      } else if (file.isVideo || file.isAudio) {
        // ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã¨ç¾åœ¨ã®ãƒ‘ã‚¹ã‚’ä¿å­˜
        sessionStorage.setItem('fileListIndex', currentIndex);
        sessionStorage.setItem('fileListPath', currentRelativePath);
        // ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã§é–‹ã
        window.location.href = `/media.html#/${encodeURIComponent(file.path)}`;
      } else if (isPreviewableFile(file.name)) {
        // ç”»åƒãƒ»ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
        showPreview(file);
      } else if (file.isDirectory) {
        // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å…¥ã‚‹
        window.location.href = `/?dir=${encodeURIComponent(file.path)}`;
      }
    }

    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
    document.addEventListener('keydown', async (e) => {
      switch(e.key) {
        case 'ArrowDown':
        case 'ArrowRight':
          e.preventDefault();
          if (currentIndex < files.length - 1) {
            currentIndex++;
            updateSelection();
          }
          break;
        case 'ArrowUp':
        case 'ArrowLeft':
          e.preventDefault();
          if (currentIndex > 0) {
            currentIndex--;
            updateSelection();
          }
          break;
        case 'PageDown':
          e.preventDefault();
          // 10ä»¶ä¸‹ã«ç§»å‹•
          currentIndex = Math.min(currentIndex + 10, files.length - 1);
          updateSelection();
          break;
        case 'PageUp':
          e.preventDefault();
          // 10ä»¶ä¸Šã«ç§»å‹•
          currentIndex = Math.max(currentIndex - 10, 0);
          updateSelection();
          break;
        case 'Enter':
          e.preventDefault();
          openSelected();
          break;
        case 'Escape':
        case 'Backspace':
          e.preventDefault();
          // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒé–‹ã„ã¦ã„ã‚‹å ´åˆã¯é–‰ã˜ã‚‹
          const overlay = document.getElementById('preview-overlay');
          if (overlay.classList.contains('visible')) {
            hidePreview();
            break;
          }
          // ãƒ«ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ã§ã¯ä½•ã‚‚ã—ãªã„
          if (!currentRootName && !currentRelativePath) {
            break;
          }
          // localStorageã®ä½ç½®ã‚’ã‚¯ãƒªã‚¢ï¼ˆæˆ»ã‚‹æ“ä½œæ™‚ï¼‰
          const storageKey = currentRootName ? `${currentRootName}/${currentRelativePath}` : '';
          localStorage.removeItem(`fileList_index_${storageKey}`);
          history.back();
          break;
      }
    });
    
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’å–å¾—
    initTheme();
    
    document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
    document.getElementById('preview-close').addEventListener('click', hidePreview);
    document.getElementById('preview-overlay').addEventListener('click', (e) => {
      if (e.target.id === 'preview-overlay') {
        hidePreview();
      }
    });
    
    const urlParams = new URLSearchParams(window.location.search);
    const dirParam = urlParams.get('dir');
    
    if (dirParam) {
      loadFileList(dirParam);
    } else {
      loadFileList(null);
    }
  </script>
</body>
</html>
